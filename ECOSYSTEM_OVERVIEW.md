# ç´«å¾®æ™ºèƒ½ä½“æ²»ç†åŸºç¡€è®¾æ–½ - å®Œæ•´ç”Ÿæ€æ€»ç»“

## ğŸ“‹ é¡¹ç›®æ¦‚è§ˆ

**ç´«å¾® (Ziwei)** æ˜¯ä¸€å¥—å®Œæ•´çš„ä¼ä¸šçº§ AI æ™ºèƒ½ä½“æ²»ç†åŸºç¡€è®¾æ–½ï¼Œç”±ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼š

| ç»„ä»¶ | ä¸­æ–‡å | åŠŸèƒ½ | è¯­è¨€ | çŠ¶æ€ |
|------|--------|------|------|------|
| **Tianshu** | å¤©æ¢ | ä»»åŠ¡åˆ†å‘ & èº«ä»½ä¸­å¿ƒ | Python | è§„åˆ’ä¸­ |
| **Taibai** | å¤ªç™½ | é€‚é…å™¨æ¡†æ¶ & SDK | Python | MVP |
| **Diting** | è°›å¬ | æ²»ç†ç½‘å…³ & å®¡è®¡ | Go | MVP |

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Agent (ä»»æ„æ¡†æ¶)                          â”‚
â”‚         Claude Code CLI / Dify / OpenClaw / è‡ªå®šä¹‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP/gRPC
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Taibai é€‚é…å™¨æ¡†æ¶ (å¤ªç™½)                        â”‚
â”‚  - å‘ç° Tianshu                                              â”‚
â”‚  - æ³¨å†Œ Agent                                                â”‚
â”‚  - å¿ƒè·³ä¿æ´»                                                  â”‚
â”‚  - ä¸ŠæŠ¥å®¡è®¡åˆ° Diting                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ Taibai Protocol
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Tianshu ä»»åŠ¡åˆ†å‘ä¸­å¿ƒ (å¤©æ¢)                     â”‚
â”‚  - ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†                                              â”‚
â”‚  - Agent èº«ä»½ç®¡ç†                                            â”‚
â”‚  - æƒé™ç­–ç•¥å­˜å‚¨                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Diting æ²»ç†ç½‘å…³ (è°›å¬) - 5 å±‚æ¶æ„                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ L0: èº«ä»½éªŒè¯ (X-Agent-Token / Authorization)                â”‚
â”‚ L1: é£é™©è¯„ä¼° (è§„åˆ™å¼•æ“ + LLM åˆ†æ)                          â”‚
â”‚ L2: ç­–ç•¥å†³ç­– (RBAC/ABAC + é£æ§è§„åˆ™)                         â”‚
â”‚ L3: äººæœºååŒ (CHEQ ç¡®è®¤å¼•æ“ + é£ä¹¦å®¡æ‰¹)                     â”‚
â”‚ L4: å®¡è®¡è¿½æº¯ (JSONL æ—¥å¿— + é“¾ä¸Šå­˜è¯)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  çœŸå®åç«¯ API                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. Tianshu (å¤©æ¢) - ä»»åŠ¡åˆ†å‘ä¸­å¿ƒ

**ä½ç½®**: `/home/dministrator/workspace/ziwei/tianshu/`

**åŠŸèƒ½**:
- ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†
- Agent èº«ä»½ç®¡ç†ä¸è®¤è¯
- æƒé™ç­–ç•¥å­˜å‚¨
- å®¡è®¡å­—æ®µæ³¨å…¥

**å…³é”®æ–‡ä»¶**:
- `src/core/audit.py` - å®¡è®¡å­—æ®µæ³¨å…¥ (message_id, sender, receiver, timestamp)

**çŠ¶æ€**: è§„åˆ’ä¸­ (Planning)

---

### 2. Taibai (å¤ªç™½) - é€‚é…å™¨æ¡†æ¶

**ä½ç½®**: `/home/dministrator/workspace/ziwei/taibai/`

**åŠŸèƒ½**:
- é€‚é…å™¨åŸºç±» (CLIAdapterBase, PluginAdapterBase, SDKAdapterBase)
- Ziwei SDK (Agent ç±»)
- é€‚é…å™¨æ³¨å†Œè¡¨
- åè®®å®šä¹‰

**æ ¸å¿ƒç±»**:

```python
# Agent SDK - ä¸ Tianshu å’Œ Diting é€šä¿¡
class Agent:
    def discover()           # å‘ç° Tianshu
    def register()           # æ³¨å†Œ Agent
    def heartbeat()          # å¿ƒè·³ä¿æ´»
    def trace()              # ä¸ŠæŠ¥å®¡è®¡åˆ° Diting
```

**é€‚é…å™¨åŸºç±»**:

```python
class CLIAdapterBase:       # å‘½ä»¤è¡Œå·¥å…·é€‚é…å™¨
class PluginAdapterBase:    # å¹³å°é›†æˆé€‚é…å™¨
class SDKAdapterBase:       # åº“é›†æˆé€‚é…å™¨
class AgentAdapter:         # è‡ªå®šä¹‰åè®®é€‚é…å™¨
```

**å·²å®ç°é€‚é…å™¨**:
- `adapters/claude_code_cli/` - Claude Code CLI é€‚é…å™¨

**åè®®å¸¸é‡** (`sdk/python/ziwei_taibai/protocol.py`):
```python
EVENT_REGISTER_REQUEST = "m.agent.register_request"
EVENT_IDENTITY = "m.agent.identity"
EVENT_ACTION = "m.agent.action"
EVENT_AUDIT = "m.agent.audit"
EVENT_HEARTBEAT = "m.agent.heartbeat"
EVENT_REVOKE = "m.agent.revoke"

ACTION_FILE_WRITE = "file_write"
ACTION_FILE_READ = "file_read"
ACTION_API_CALL = "api_call"
ACTION_VERIFICATION_PING = "verification_ping"
```

**çŠ¶æ€**: MVP (å¯ç”¨)

---

### 3. Diting (è°›å¬) - æ²»ç†ç½‘å…³

**ä½ç½®**: `/home/dministrator/workspace/ziwei/diting/`

**æ¶æ„**: 5 å±‚è®¾è®¡

#### L0 - èº«ä»½éªŒè¯å±‚
```go
// ä» X-Agent-Token æˆ– Authorization æå–èº«ä»½
// ä¸ allowed_api_keys åˆ—è¡¨æ¯”å¯¹
// å¤±è´¥è¿”å› 401 Unauthorized
```

#### L1 - é£é™©è¯„ä¼°å±‚
```go
// è§„åˆ™å¼•æ“ (policy/engine.go)
// - åŸºäº HTTP æ–¹æ³• (GET/DELETE/...)
// - åŸºäº URL è·¯å¾„ (/admin, /delete, ...)
// - åŸºäºè¯·æ±‚ä½“å†…å®¹ (å±é™©å…³é”®è¯)
// - è¿”å›é£é™©åˆ†æ•° (0-100)

// LLM åˆ†æ (å¯é€‰)
// - é›†æˆ Ollama / OpenAI
// - åˆ†ææ“ä½œæ„å›¾
// - è‡ªåŠ¨é™çº§åˆ°è§„åˆ™å¼•æ“
```

#### L2 - ç­–ç•¥å†³ç­–å±‚
```go
// PolicyEngine.Evaluate() è¿”å›å†³ç­–
type Decision struct {
    Kind DecisionKind  // Allow / Deny / Review
    PolicyRuleID string
    DecisionReason string
}
```

#### L3 - äººæœºååŒå±‚
```go
// CHEQ ç¡®è®¤å¼•æ“ (cheq/engine.go)
// - åˆ›å»ºå¾…ç¡®è®¤å¯¹è±¡
// - æ”¯æŒå¤šå®¡æ‰¹äºº (I-008)
// - æ”¯æŒå®¡æ‰¹ç­–ç•¥ (any/all) (I-009)
// - è¶…æ—¶è‡ªåŠ¨è¿‡æœŸ

// æŠ•é€’æ–¹å¼ (delivery/feishu/)
// - é£ä¹¦å¡ç‰‡ (äº¤äº’å¼)
// - é£ä¹¦é•¿è¿æ¥ (WebSocket)
// - ä¼ä¸šå¾®ä¿¡ (è§„åˆ’ä¸­)
// - é’‰é’‰ (è§„åˆ’ä¸­)
```

#### L4 - å®¡è®¡è¿½æº¯å±‚
```go
// Evidence æ¨¡å‹ (models/audit.go)
type Evidence struct {
    TraceID string
    AgentID string
    PolicyRuleID string
    Decision string        // allow/deny/review/approved/rejected/expired
    CHEQStatus string
    Confirmer string
    Timestamp time.Time
    Resource string
    Action string
}

// å­˜å‚¨æ–¹å¼
// - JSONL æ–‡ä»¶ (å®æ—¶)
// - PostgreSQL (ç»“æ„åŒ–)
// - ClickHouse (æ—¶åºåˆ†æ)
// - S3/OSS (å½’æ¡£)
```

**å…³é”®æ–‡ä»¶**:

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `cmd/diting/main.go` | å…¥å£ç‚¹ |
| `cmd/diting/internal/proxy/handler.go` | HTTP ä»£ç†å¤„ç† |
| `cmd/diting/internal/proxy/pipeline.go` | L0-L4 æµæ°´çº¿ |
| `cmd/diting/internal/policy/engine.go` | ç­–ç•¥å¼•æ“æ¥å£ |
| `cmd/diting/internal/cheq/engine.go` | CHEQ ç¡®è®¤å¼•æ“ |
| `cmd/diting/internal/audit/store.go` | å®¡è®¡å­˜å‚¨æ¥å£ |
| `cmd/diting/internal/models/decision.go` | å†³ç­–æ¨¡å‹ |
| `cmd/diting/internal/models/audit.go` | å®¡è®¡æ¨¡å‹ |
| `cmd/diting/config.yaml` | é…ç½®æ¨¡æ¿ |

**é…ç½®ç¤ºä¾‹**:

```yaml
proxy:
  listen_addr: ":8080"
  upstream: "http://localhost:8081"
  allowed_api_keys: ["key1", "key2"]

policy:
  rules_path: "policy_rules.yaml"

cheq:
  timeout_seconds: 120
  approval_rules:
    - path_prefix: "/admin"
      risk_level: "high"
      timeout_seconds: 300
      approval_user_ids: ["user1", "user2"]
      approval_policy: "all"

delivery:
  feishu:
    app_id: "xxx"
    enabled: true
    approval_user_ids: ["user1"]
    approval_policy: "any"
    use_card_delivery: true
    use_long_connection: true

audit:
  path: "./data/audit.jsonl"
  redact: ["password", "token"]
```

**ç­–ç•¥è§„åˆ™ç¤ºä¾‹** (`policy_rules.example.yaml`):

```yaml
rules:
  - id: allow_exec_run
    action: "exec:run"
    resource: "*"
    decision: allow
    reason: æœ¬åœ°æ‰§è¡Œæ”¾è¡Œ

  - id: review_exec_sudo
    action: "exec:sudo"
    resource: "*"
    decision: review
    reason: sudo éœ€äººå·¥ç¡®è®¤

  - id: deny_delete
    action: DELETE
    resource: "*"
    decision: deny
    reason: ç¦æ­¢åˆ é™¤æ“ä½œ
```

**çŠ¶æ€**: MVP (å¯ç”¨)

---

## ğŸ”„ å·¥ä½œæµç¨‹

### è¯·æ±‚å¤„ç†æµç¨‹

```
1. Agent å‘é€è¯·æ±‚åˆ° Diting
   â”œâ”€ åŒ…å« X-Agent-Token æˆ– Authorization
   â””â”€ ç›®æ ‡ URL: http://diting:8080/path

2. Diting ç”Ÿæˆ trace_id (UUID)
   â””â”€ ç”¨äºå…¨é“¾è·¯è¿½è¸ª

3. L0 èº«ä»½éªŒè¯
   â”œâ”€ æå– X-Agent-Token
   â”œâ”€ ä¸ allowed_api_keys æ¯”å¯¹
   â””â”€ å¤±è´¥ â†’ 401 + å®¡è®¡

4. L1 é£é™©è¯„ä¼°
   â”œâ”€ è§„åˆ™å¼•æ“è¯„åˆ†
   â”œâ”€ LLM åˆ†æ (å¯é€‰)
   â””â”€ ç»¼åˆé£é™©åˆ†æ•°

5. L2 ç­–ç•¥å†³ç­–
   â”œâ”€ PolicyEngine.Evaluate()
   â””â”€ è¿”å› Allow / Deny / Review

6. æ ¹æ®å†³ç­–æ‰§è¡Œ
   â”œâ”€ Allow â†’ è½¬å‘è¯·æ±‚ + å®¡è®¡
   â”œâ”€ Deny â†’ æ‹’ç» + å®¡è®¡
   â””â”€ Review â†’ åˆ›å»º CHEQ + ç­‰å¾…å®¡æ‰¹

7. å¦‚æœéœ€è¦äººå·¥å®¡æ‰¹ (Review)
   â”œâ”€ åˆ›å»º ConfirmationObject
   â”œâ”€ æŠ•é€’åˆ°é£ä¹¦ (å¡ç‰‡/é•¿è¿æ¥)
   â”œâ”€ ç­‰å¾…å®¡æ‰¹äººç¡®è®¤
   â”œâ”€ è¶…æ—¶è‡ªåŠ¨è¿‡æœŸ
   â””â”€ æ ¹æ®ç»“æœè½¬å‘æˆ–æ‹’ç»

8. è®°å½•å®¡è®¡æ—¥å¿—
   â””â”€ Evidence â†’ JSONL / PostgreSQL / ClickHouse
```

### å®¡æ‰¹æµç¨‹ (CHEQ)

```
1. åˆ›å»º ConfirmationObject
   â”œâ”€ ID: UUID
   â”œâ”€ Status: pending
   â”œâ”€ ExpiresAt: now + timeout
   â””â”€ ConfirmerIDs: [user1, user2]

2. æŠ•é€’åˆ°é£ä¹¦
   â”œâ”€ æ–¹å¼ 1: å¡ç‰‡ (äº¤äº’å¼)
   â”‚  â””â”€ æ‰¹å‡†/æ‹’ç»æŒ‰é’®
   â”œâ”€ æ–¹å¼ 2: é•¿è¿æ¥ (WebSocket)
   â”‚  â””â”€ å®æ—¶äº‹ä»¶æ¨é€
   â””â”€ æ–¹å¼ 3: æ–‡æœ¬ + é“¾æ¥
      â””â”€ æ‰‹åŠ¨ç‚¹å‡»é“¾æ¥

3. å®¡æ‰¹äººæ“ä½œ
   â”œâ”€ æ‰¹å‡† â†’ Status: approved
   â”œâ”€ æ‹’ç» â†’ Status: rejected
   â””â”€ è¶…æ—¶ â†’ Status: expired

4. ç½‘å…³è½®è¯¢æ£€æŸ¥
   â”œâ”€ æ¯ 2 ç§’æ£€æŸ¥ä¸€æ¬¡
   â”œâ”€ æ£€æŸ¥ Status æ˜¯å¦ç»ˆæ€
   â””â”€ è¶…æ—¶å‰ 60 ç§’å‘é£ä¹¦æé†’

5. æ‰§è¡Œå†³ç­–
   â”œâ”€ approved â†’ è½¬å‘è¯·æ±‚
   â”œâ”€ rejected â†’ æ‹’ç»è¯·æ±‚
   â””â”€ expired â†’ æ‹’ç»è¯·æ±‚

6. è®°å½•å®¡è®¡
   â””â”€ CHEQStatus: approved/rejected/expired
      Confirmer: å®¡æ‰¹äºº ID
```

---

## ğŸ“Š æ•°æ®æ¨¡å‹

### RequestContext (è¯·æ±‚ä¸Šä¸‹æ–‡)

```go
type RequestContext struct {
    AgentIdentity string              // L0 èº«ä»½
    Method string                     // HTTP æ–¹æ³•
    TargetURL string                  // ç›®æ ‡ URL
    Resource string                   // èµ„æºè·¯å¾„
    Action string                     // æ“ä½œç±»å‹
    Headers http.Header               // HTTP å¤´
    Context map[string]string         // æ‰©å±•å­—æ®µ (risk_level ç­‰)
}
```

### Decision (å†³ç­–ç»“æœ)

```go
type Decision struct {
    Kind DecisionKind                 // Allow / Deny / Review
    PolicyRuleID string               // å‘½ä¸­çš„è§„åˆ™ ID
    DecisionReason string             // å†³ç­–ç†ç”±
}
```

### Evidence (å®¡è®¡è®°å½•)

```go
type Evidence struct {
    TraceID string                    // å…¨é“¾è·¯è¿½è¸ª ID
    SpanID string                     // è·¨åº¦ ID (å¯é€‰)
    AgentID string                    // Agent ID
    PolicyRuleID string               // ç­–ç•¥è§„åˆ™ ID
    DecisionReason string             // å†³ç­–ç†ç”±
    Decision string                   // allow/deny/review/approved/rejected/expired
    CHEQStatus string                 // CHEQ çŠ¶æ€ (å¯é€‰)
    Confirmer string                  // å®¡æ‰¹äºº (å¯é€‰)
    Timestamp time.Time               // æ—¶é—´æˆ³
    Resource string                   // èµ„æº
    Action string                     // æ“ä½œ
}
```

### ConfirmationObject (ç¡®è®¤å¯¹è±¡)

```go
type ConfirmationObject struct {
    ID string                         // å”¯ä¸€ ID
    TraceID string                    // å…³è”çš„ trace_id
    Resource string                   // èµ„æº
    Action string                     // æ“ä½œ
    Summary string                    // æ‘˜è¦
    Status ConfirmationStatus         // pending/approved/rejected/expired
    ExpiresAt time.Time               // è¿‡æœŸæ—¶é—´
    ConfirmerIDs []string             // å®¡æ‰¹äººåˆ—è¡¨
    ApprovalPolicy string             // any / all
    CreatedAt time.Time               // åˆ›å»ºæ—¶é—´
    UpdatedAt time.Time               // æ›´æ–°æ—¶é—´
}
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨ Diting ç½‘å…³

```bash
cd /home/dministrator/workspace/ziwei/diting/cmd/diting

# ç¼–è¯‘
go build -o bin/diting ./cmd/diting_allinone

# è¿è¡Œ
./bin/diting
```

### 2. é…ç½® Agent

```python
from ziwei_taibai.adapters.cli_base import CLIAdapterBase
from ziwei_taibai.agent import Agent

class MyAdapter(CLIAdapterBase):
    def __init__(self, config):
        super().__init__(config, "my-cli", [])
        self.sdk = Agent(
            owner=config.owner_id,
            tianshu_api_base="http://localhost:8082",
            diting_audit_url="http://localhost:8080/api/audit",
        )

    async def initialize(self):
        self.sdk.discover()
        self.sdk.register(agent_display_id="my-agent")
        return True

    async def execute_task(self, task):
        # æ‰§è¡Œä»»åŠ¡
        return TaskResult(task_id=task.id, status="success")
```

### 3. å‘é€è¯·æ±‚

```bash
# å¸¦èº«ä»½ä»¤ç‰Œçš„è¯·æ±‚
curl -H "X-Agent-Token: key1" http://localhost:8080/api/users

# æˆ–ä½¿ç”¨ Authorization
curl -H "Authorization: Bearer key1" http://localhost:8080/api/users
```

---

## ğŸ“ˆ æ¶æ„æ¼”è¿›è·¯çº¿

### Phase 1: MVP (å½“å‰)
- âœ… L0 èº«ä»½éªŒè¯
- âœ… L1 é£é™©è¯„ä¼° (è§„åˆ™å¼•æ“)
- âœ… L2 ç­–ç•¥å†³ç­– (åŸºç¡€)
- âœ… L3 äººæœºååŒ (CHEQ + é£ä¹¦)
- âœ… L4 å®¡è®¡è¿½æº¯ (JSONL)

### Phase 2: ä¼ä¸šçº§ (3 ä¸ªæœˆ)
- ğŸ”„ å®Œæ•´ç­–ç•¥å¼•æ“ (RBAC/ABAC)
- ğŸ”„ Web ç®¡ç†åå°
- ğŸ”„ ä¼ä¸šå¾®ä¿¡/é’‰é’‰é›†æˆ
- ğŸ”„ LDAP/AD è®¤è¯
- ğŸ”„ å¤šç§Ÿæˆ·æ”¯æŒ

### Phase 3: å¹³å°åŒ– (6 ä¸ªæœˆ)
- ğŸ”„ PostgreSQL å­˜å‚¨
- ğŸ”„ ClickHouse åˆ†æ
- ğŸ”„ å¯è§†åŒ–å¤§å±
- ğŸ”„ è‡ªåŠ¨åŒ–è¿è¥
- ğŸ”„ å‘Šè­¦é€šçŸ¥ç³»ç»Ÿ

### Phase 4: ç”Ÿæ€åŒ– (12 ä¸ªæœˆ)
- ğŸ”„ å¼€æ”¾ API
- ğŸ”„ æ’ä»¶å¸‚åœº
- ğŸ”„ ç¤¾åŒºç”Ÿæ€
- ğŸ”„ eBPF å†…æ ¸ç›‘æ§
- ğŸ”„ é“¾ä¸Šå­˜è¯

---

## ğŸ” å®‰å…¨ç‰¹æ€§

### 1. é›¶ä¿¡ä»»æ¶æ„
- æ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦èº«ä»½éªŒè¯ (L0)
- æ‰€æœ‰æ“ä½œéƒ½éœ€è¦é£é™©è¯„ä¼° (L1)
- æ‰€æœ‰å†³ç­–éƒ½å¯è¿½æº¯ (L4)

### 2. äººæœºååŒ
- AI æä¾›å»ºè®® (é£é™©è¯„åˆ†)
- äººç±»åšæœ€ç»ˆå†³ç­– (CHEQ å®¡æ‰¹)
- å¹³è¡¡æ•ˆç‡ä¸å®‰å…¨

### 3. å®Œæ•´å®¡è®¡
- å…¨é“¾è·¯è¿½è¸ª (trace_id)
- å†³ç­–ç†ç”±è®°å½• (decision_reason)
- å®¡æ‰¹äººä¿¡æ¯ (confirmer)
- æ—¶é—´æˆ³ (æ¯«ç§’çº§)

### 4. æ™ºèƒ½é™çº§
- LLM ä¸å¯ç”¨ â†’ è§„åˆ™å¼•æ“
- é£ä¹¦ä¸å¯ç”¨ â†’ CLI å®¡æ‰¹
- ä¿è¯ç³»ç»Ÿå§‹ç»ˆå¯ç”¨

---

## ğŸ“š æ–‡æ¡£ç´¢å¼•

| æ–‡æ¡£ | ä½ç½® | ç”¨é€” |
|------|------|------|
| é¡¹ç›®æ€»ç»“ | `diting/docs/PROJECT_SUMMARY.md` | é¡¹ç›®æ¦‚è¿° |
| å®Œæ•´æ¶æ„ | `diting/docs/ARCHITECTURE_FULL.md` | 5 å±‚æ¶æ„è¯¦è§£ |
| é¡¹ç›®ç»“æ„ | `diting/docs/STRUCTURE.md` | ç›®å½•ç»„ç»‡ |
| å¿«é€Ÿå¼€å§‹ | `diting/docs/QUICKSTART.md` | 5 åˆ†é’Ÿå…¥é—¨ |
| éƒ¨ç½²æŒ‡å— | `diting/docs/INSTALL.md` | è¯¦ç»†éƒ¨ç½² |
| æµ‹è¯•åœºæ™¯ | `diting/docs/TEST.md` | æµ‹è¯•ç”¨ä¾‹ |
| æ¼”ç¤ºè„šæœ¬ | `diting/docs/DEMO.md` | æ¼”ç¤ºè¯æœ¯ |
| é€‚é…å™¨å¼€å‘ | `taibai/docs/adapter-development-guide.md` | é€‚é…å™¨å¼€å‘ |

---

## ğŸ¯ å…³é”®æ¦‚å¿µ

### Trace ID
- å…¨é“¾è·¯è¿½è¸ªæ ‡è¯†ç¬¦
- æ ¼å¼: UUID
- ç”¨é€”: å…³è”æ‰€æœ‰ç›¸å…³çš„å®¡è®¡è®°å½•

### Policy Rule ID
- ç­–ç•¥è§„åˆ™æ ‡è¯†ç¬¦
- ç”¨é€”: è¿½æº¯å†³ç­–ä¾æ®

### Decision Reason
- å†³ç­–ç†ç”±
- ç”¨é€”: è§£é‡Šä¸ºä»€ä¹ˆåšå‡ºè¿™ä¸ªå†³ç­–

### CHEQ Status
- ç¡®è®¤å¯¹è±¡çŠ¶æ€
- å€¼: pending / approved / rejected / expired

### Approval Policy
- å®¡æ‰¹ç­–ç•¥
- any: ä»»ä¸€å®¡æ‰¹äººæ‰¹å‡†å³å¯
- all: æ‰€æœ‰å®¡æ‰¹äººéƒ½å¿…é¡»æ‰¹å‡†

---

## ğŸ”— é›†æˆç‚¹

### ä¸ Tianshu çš„é›†æˆ
- å‘ç° (Discovery)
- æ³¨å†Œ (Registration)
- å¿ƒè·³ (Heartbeat)

### ä¸ Taibai çš„é›†æˆ
- é€‚é…å™¨åŸºç±»
- SDK (Agent ç±»)
- åè®®å®šä¹‰

### ä¸é£ä¹¦çš„é›†æˆ
- å¡ç‰‡æŠ•é€’
- é•¿è¿æ¥ (WebSocket)
- äº‹ä»¶å›è°ƒ

### ä¸åç«¯ API çš„é›†æˆ
- HTTP åå‘ä»£ç†
- è¯·æ±‚è½¬å‘
- å“åº”é€ä¼ 

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. é…ç½®ç®¡ç†
- æ•æ„Ÿé¡¹ä»ç¯å¢ƒå˜é‡è¦†ç›–
- ä¸è¦åœ¨ YAML ä¸­å†™å¯†é’¥
- ä½¿ç”¨ `.env` æ–‡ä»¶ç®¡ç†

### 2. å®¡è®¡æ—¥å¿—
- è®°å½•æ‰€æœ‰å†³ç­–
- åŒ…å«å®Œæ•´ä¸Šä¸‹æ–‡
- æ”¯æŒäº‹åæº¯æº

### 3. é”™è¯¯å¤„ç†
- ä¼˜é›…é™çº§
- æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
- å®Œæ•´çš„é”™è¯¯æ—¥å¿—

### 4. æ€§èƒ½ä¼˜åŒ–
- ç¼“å­˜ç­–ç•¥è§„åˆ™
- å¼‚æ­¥æŠ•é€’é£ä¹¦
- æ‰¹é‡å†™å®¡è®¡æ—¥å¿—

### 5. å®‰å…¨åŠ å›º
- éªŒè¯æ‰€æœ‰è¾“å…¥
- è„±æ•æ•æ„Ÿå­—æ®µ
- é™åˆ¶è¯·æ±‚é€Ÿç‡

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å¸¸è§é—®é¢˜

**Q: å¦‚ä½•æ·»åŠ æ–°çš„å®¡æ‰¹äºº?**
A: åœ¨ `config.yaml` çš„ `approval_rules` ä¸­é…ç½® `approval_user_ids`

**Q: å¦‚ä½•ä¿®æ”¹å®¡æ‰¹è¶…æ—¶?**
A: åœ¨ `config.yaml` çš„ `cheq.timeout_seconds` ä¸­ä¿®æ”¹

**Q: å¦‚ä½•é›†æˆä¼ä¸šå¾®ä¿¡?**
A: åœ¨ `delivery` ä¸­æ·»åŠ ä¼ä¸šå¾®ä¿¡é…ç½® (Phase 2 åŠŸèƒ½)

**Q: å¦‚ä½•æŸ¥è¯¢å®¡è®¡æ—¥å¿—?**
A: ä½¿ç”¨ `audit.QueryByTraceID(ctx, traceID)` æŒ‰ trace_id æŸ¥è¯¢

---

## ğŸ‰ æ€»ç»“

ç´«å¾® (Ziwei) æ˜¯ä¸€å¥—å®Œæ•´çš„ã€ç”Ÿäº§å°±ç»ªçš„ AI æ™ºèƒ½ä½“æ²»ç†åŸºç¡€è®¾æ–½ï¼š

- **Tianshu**: ä»»åŠ¡åˆ†å‘ä¸­å¿ƒ (è§„åˆ’ä¸­)
- **Taibai**: é€‚é…å™¨æ¡†æ¶ (MVP)
- **Diting**: æ²»ç†ç½‘å…³ (MVP)

æ ¸å¿ƒç‰¹æ€§ï¼š
- âœ… é›¶ä¿¡ä»»æ¶æ„
- âœ… äººæœºååŒ
- âœ… å®Œæ•´å®¡è®¡
- âœ… æ™ºèƒ½é™çº§
- âœ… æ˜“äºæ‰©å±•

é€‚ç”¨åœºæ™¯ï¼š
- AI æ™ºèƒ½ä½“å®‰å…¨æ²»ç†
- ä¼ä¸šçº§å®¡è®¡åˆè§„
- é£é™©å†³ç­–æ”¯æŒ
- æ“ä½œå®¡æ‰¹æµç¨‹
