# 悟空 (Wukong) - 开发路线图

**版本**：v1.0
**更新日期**：2026-02-16

---

## 项目愿景

成为紫微智能体治理平台的标准 Agent 生命周期管理器，让用户能够一键启动、管理和监控 AI Agent，实现零侵入的治理接入。

---

## 里程碑

### Phase 0: 规划与设计 ✅ (当前)

**时间**：2026-02-16 ~ 2026-02-20
**目标**：完成需求分析、架构设计、PRD 编写

- [x] 需求分析与流程设计
- [x] 创建项目结构
- [x] 编写基础文档（README, STRUCTURE, DEVELOPMENT, DELIVERY）
- [ ] 完成 PRD（通过 BMAD 工作流）
- [ ] 完成架构设计
- [ ] 完成 Epic 与 Story 拆分

**交付物**：
- PRD 文档
- 架构设计文档
- Epic 与 Story 列表

---

### Phase 1: MVP (最小可行产品)

**时间**：2026-02-21 ~ 2026-03-15
**目标**：实现核心功能，支持 Claude Agent 一键启动

#### Sprint 1: 身份管理 (2 周)
- [ ] 身份管理器实现
  - [ ] 身份注册（调用天枢/太白 SDK）
  - [ ] 身份缓存（本地持久化）
  - [ ] 身份验证（心跳验证）
  - [ ] 审批处理（分级审批）
- [ ] 天枢客户端实现
  - [ ] 注册 API
  - [ ] 心跳 API
  - [ ] 状态上报 API
- [ ] 单元测试（覆盖率 > 80%）

**验收标准**：
- ✅ 用户可以成功注册 Agent 身份
- ✅ 身份持久化到本地
- ✅ 支持低/中/高风险分级审批
- ✅ 身份验证通过

#### Sprint 2: 生命周期管理 (2 周)
- [ ] Agent 管理器实现
  - [ ] Agent 启动（本地模式）
  - [ ] Agent 停止
  - [ ] Agent 重启
  - [ ] 进程监控
- [ ] Claude 适配器实现
  - [ ] Claude CLI 启动逻辑
  - [ ] diting-hook 配置
  - [ ] 环境变量配置
- [ ] 单元测试

**验收标准**：
- ✅ 用户可以通过 `wukong claude` 启动 Agent
- ✅ Agent 进程正常运行
- ✅ diting-hook 正确配置
- ✅ 支持停止、重启操作

#### Sprint 3: 状态管理与 CLI (2 周)
- [ ] 状态管理器实现
  - [ ] 本地状态维护
  - [ ] 状态变更检测
  - [ ] 状态上报到天枢
  - [ ] 治理状态接收
- [ ] CLI 命令实现
  - [ ] `wukong claude` (start)
  - [ ] `wukong list`
  - [ ] `wukong status <name>`
  - [ ] `wukong stop <name>`
  - [ ] `wukong restart <name>`
  - [ ] `wukong logs <name>`
  - [ ] `wukong identity`
- [ ] 集成测试

**验收标准**：
- ✅ Agent 状态实时同步到天枢
- ✅ 用户可以通过飞书/Web/CLI 查询 Agent 状态
- ✅ 所有 CLI 命令正常工作
- ✅ 集成测试通过

#### Sprint 4: 测试与文档 (1 周)
- [ ] E2E 测试
  - [ ] 完整启动流程测试
  - [ ] 审批流程测试
  - [ ] 状态同步测试
- [ ] 文档完善
  - [ ] API 文档
  - [ ] 用户手册
  - [ ] 故障排查指南
- [ ] Bug 修复

**验收标准**：
- ✅ E2E 测试通过
- ✅ 文档完整
- ✅ 至少一个真实场景持续使用 7 天

**Phase 1 交付物**：
- 可用的悟空 CLI 工具
- 支持 Claude Agent 一键启动
- 完整的测试覆盖
- 用户文档

---

### Phase 2: 增强功能

**时间**：2026-03-16 ~ 2026-04-30
**目标**：增强沙箱、多 Agent 管理、自动重启

#### Sprint 5: Docker 沙箱 (2 周)
- [ ] Docker 沙箱管理器
  - [ ] 容器创建
  - [ ] 容器启动/停止
  - [ ] 工作目录挂载
  - [ ] 网络配置
- [ ] Docker 模式适配
  - [ ] Claude 适配器 Docker 支持
  - [ ] diting-hook 注入
- [ ] 测试

**验收标准**：
- ✅ 用户可以通过 `wukong claude --mode sandbox` 启动 Docker 沙箱
- ✅ 沙箱隔离有效
- ✅ 工作目录正确挂载

#### Sprint 6: gVisor 深度沙箱 (2 周)
- [ ] gVisor 沙箱管理器
  - [ ] runsc 运行时配置
  - [ ] 内核级隔离
- [ ] gVisor 模式适配
- [ ] 性能测试

**验收标准**：
- ✅ 用户可以通过 `wukong claude --mode deep-sandbox` 启动 gVisor 沙箱
- ✅ 深度隔离有效
- ✅ 性能可接受

#### Sprint 7: 多 Agent 管理 (2 周)
- [ ] 多实例支持
  - [ ] Agent 实例命名
  - [ ] 实例隔离
  - [ ] 批量操作
- [ ] 增强 CLI
  - [ ] `wukong start <type> --name <name>`
  - [ ] `wukong list --filter <status>`
  - [ ] `wukong stop --all`
- [ ] 测试

**验收标准**：
- ✅ 用户可以同时运行多个 Agent 实例
- ✅ 实例之间互不干扰
- ✅ 支持批量操作

#### Sprint 8: 自动重启与监控 (2 周)
- [ ] 自动重启逻辑
  - [ ] 崩溃检测
  - [ ] 重启策略（立即/延迟/指数退避）
  - [ ] 重启次数限制
- [ ] 增强监控
  - [ ] 资源使用监控
  - [ ] 性能指标收集
- [ ] 告警（可选）

**验收标准**：
- ✅ Agent 崩溃后自动重启
- ✅ 重启策略可配置
- ✅ 监控数据可查询

**Phase 2 交付物**：
- Docker 和 gVisor 沙箱支持
- 多 Agent 管理能力
- 自动重启与监控

---

### Phase 3: 生态扩展

**时间**：2026-05-01 ~ 2026-06-30
**目标**：支持更多 Agent 类型，构建适配器生态

#### Sprint 9: Cursor 适配器 (2 周)
- [ ] Cursor 适配器实现
- [ ] Cursor 特定配置
- [ ] 测试

#### Sprint 10: 通用适配器框架 (2 周)
- [ ] 适配器插件系统
- [ ] 适配器注册机制
- [ ] 适配器开发文档

#### Sprint 11: 社区适配器 (4 周)
- [ ] 适配器市场（可选）
- [ ] 社区贡献指南
- [ ] 示例适配器

**Phase 3 交付物**：
- Cursor 适配器
- 通用适配器框架
- 社区贡献生态

---

### Phase 4: 企业级功能 (未来)

**时间**：2026-07-01 ~
**目标**：企业级功能，Web UI，高可用

- [ ] Web UI
  - [ ] Agent 管理界面
  - [ ] 状态监控面板
  - [ ] 日志查看器
- [ ] 高可用
  - [ ] 多节点部署
  - [ ] 负载均衡
  - [ ] 故障转移
- [ ] 企业集成
  - [ ] LDAP/AD 集成
  - [ ] SSO 支持
  - [ ] 审计日志导出

---

## 当前优先级

### P0 (必须做)
- [x] 项目结构与文档
- [ ] PRD 与架构设计
- [ ] 身份管理
- [ ] 生命周期管理
- [ ] 状态管理
- [ ] Claude 适配器
- [ ] 基础 CLI 命令

### P1 (应该做)
- [ ] Docker 沙箱
- [ ] 多 Agent 管理
- [ ] 自动重启
- [ ] E2E 测试

### P2 (可以做)
- [ ] gVisor 深度沙箱
- [ ] Cursor 适配器
- [ ] Web UI

---

## 依赖关系

### 外部依赖
- **天枢**：Agent 注册、心跳、状态上报 API（已实现）
- **太白**：太白 SDK（可选，或直接调用天枢）
- **谛听**：diting-hook 配置（已实现）

### 内部依赖
- Phase 2 依赖 Phase 1 完成
- Phase 3 依赖 Phase 2 完成

---

## 风险与缓解

### 风险 1：天枢 API 变更
**影响**：高
**概率**：中
**缓解**：
- 与天枢团队保持沟通
- 使用太白 SDK 抽象 API 调用
- 编写适配层

### 风险 2：Docker/gVisor 兼容性问题
**影响**：中
**概率**：中
**缓解**：
- 提前测试不同环境
- 提供本地模式作为 fallback
- 详细的故障排查文档

### 风险 3：Agent 适配复杂度
**影响**：中
**概率**：高
**缓解**：
- 先支持 Claude，验证架构
- 设计通用适配器接口
- 提供适配器开发文档

---

## 成功指标

### MVP 成功标准
- ✅ 用户可以通过 `wukong claude` 一键启动 Agent
- ✅ 身份注册流程完整（支持分级审批）
- ✅ Agent 状态实时同步到天枢
- ✅ 支持基本的 Agent 管理命令
- ✅ 至少一个真实场景持续使用 7 天

### 长期成功标准
- 成为紫微平台的标准 Agent 启动方式
- 支持 10+ 种主流 Agent 框架
- 社区贡献的适配器生态
- 企业级部署案例

---

## 参考资料

- 紫微技术方案：`/docs/open/technical/紫微智能体治理基础设施-技术方案.md`
- 平台规划：`/_bmad-output/planning-artifacts/紫微平台规划梳理.md`
- 天枢 PRD：`/tianshu/_bmad-output/planning-artifacts/prd.md`
- 谛听 PRD：`/diting/_bmad-output/planning-artifacts/prd.md`
