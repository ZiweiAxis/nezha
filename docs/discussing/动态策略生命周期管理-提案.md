# åŠ¨æ€ç­–ç•¥ç”Ÿå‘½å‘¨æœŸç®¡ç† - ææ¡ˆ

> çŠ¶æ€ï¼šè®¨è®ºä¸­
> åˆ›å»ºæ—¶é—´ï¼š2026-02-17

## èƒŒæ™¯

é™æ€ç­–ç•¥å¼•æ“Žï¼ˆå¦‚ Cedar/OPA åŸºç¡€ç”¨æ³•ï¼‰ä¸»è¦è§£å†³çš„æ˜¯"é™æ€è§„åˆ™åŒ¹é…"é—®é¢˜ã€‚ä½†åœ¨å®žé™… AI Agent æ²»ç†åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ”¯æŒ"ç”³è¯·-å®¡æ‰¹-ç”Ÿæˆ-å¤±æ•ˆ"çš„åŠ¨æ€é—­çŽ¯ã€‚

æœ¬æ–‡æ¡£æè¿°ç´«å¾®ç³»ç»Ÿå¦‚ä½•å®žçŽ°"æŒç»­æŽˆæƒ"ï¼ˆContinuous Authorizationï¼‰æ¨¡å¼ï¼Œä»¥åŠä¸Žæ‚Ÿç©ºæ‹¦æˆªå™¨çš„é…åˆã€‚

---

## ä¸€ã€æ ¸å¿ƒæ¦‚å¿µï¼šä»Ž"é™æ€é…ç½®"è½¬å‘"åŠ¨æ€å‡­è¯"

### ä¼ ç»Ÿæ¨¡å¼ vs åŠ¨æ€æŽˆæƒæ¨¡å¼

| ç»´åº¦ | ä¼ ç»Ÿé™æ€ç­–ç•¥ | åŠ¨æ€æŽˆæƒæ¨¡å¼ |
|------|-------------|-------------|
| ç­–ç•¥æ›´æ–° | ä¿®æ”¹ç­–ç•¥æ–‡ä»¶ | åŠ¨æ€ç”Ÿæˆå‡­è¯ |
| æ—¶æ•ˆæ€§ | æ°¸ä¹…/é•¿æœŸ | ä¸´æ—¶ï¼ˆå¯è®¾ç½®è¿‡æœŸæ—¶é—´ï¼‰ |
| ç²’åº¦ | è§’è‰²/èµ„æºçº§åˆ« | è¡Œçº§/åˆ—çº§èŒƒå›´ |
| æ’¤é”€æ–¹å¼ | åˆ é™¤ç­–ç•¥è§„åˆ™ | åˆ é™¤å‡­è¯/ç­‰å¾…è¿‡æœŸ |
| å®¡è®¡ | ç­–ç•¥å˜æ›´å®¡è®¡ | æŽˆæƒä½¿ç”¨å®¡è®¡ |

### é€‚ç”¨åœºæ™¯

- AI Agent éœ€è¦è®¿é—®ç‰¹å®šå®¢æˆ·æ•°æ®ï¼ˆä¸´æ—¶ï¼‰
- æ‰¹é‡æ“ä½œæŽˆæƒï¼ˆä¸€æ¬¡æ€§/æ—¶æ•ˆæ€§ï¼‰
- æ•æ„Ÿè¡¨/å­—æ®µçš„ä¸´æ—¶è®¿é—®æƒ
- å§”æ‰˜ä»£ç†ï¼ˆäººç±»å§”æ‰˜ AI ä»£ç†æ‰§è¡Œï¼‰

---

## äºŒã€æž¶æž„è®¾è®¡

### 2.1 ç³»ç»Ÿæž¶æž„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AI Agent  â”‚â”€â”€â”€â”€â–¶â”‚    æ‚Ÿç©º     â”‚â”€â”€â”€â”€â–¶â”‚    ç¬è±¸     â”‚
â”‚  (DID èº«ä»½) â”‚     â”‚  (æ‹¦æˆªå™¨)   â”‚     â”‚ (ç­–ç•¥+å®¡æ‰¹) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                    â”‚
                           â”‚ ç­–ç•¥å†…ç›´æŽ¥æ”¾è¡Œ      â”‚
                           â”‚                    â–¼
                           â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚            â”‚   ç­–ç•¥å¼•æ“Ž   â”‚
                           â”‚            â”‚  (OPA/Cedar)â”‚
                           â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                    â”‚
                           â”‚ ç­–ç•¥å¤–             â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
                                              â”‚
                                              â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ Matrix/é£žä¹¦ â”‚
                                    â”‚ (å®¡æ‰¹ç•Œé¢)   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 äº¤äº’æµç¨‹

```mermaid
sequenceDiagram
    participant Agent as AI Agent
    participant Wukong as æ‚Ÿç©ºæ‹¦æˆªå™¨
    participant Xiezhi as ç¬è±¸
    participant Human as äººç±»å®¡æ‰¹

    Note over Wukong: 1. æŽ¥æ”¶ç­–ç•¥ä¸‹å‘
    Xiezhi->>Wukong: ç­–ç•¥è§„åˆ™æŽ¨é€

    Note over Agent: 2. Agent å‘èµ·è¯·æ±‚
    Agent->>Wukong: è¯·æ±‚æ‰§è¡Œ

    Note over Wukong: 3. æœ¬åœ°ç­–ç•¥è¯„ä¼°
    Wukong->>Wukong: åŒ¹é…ç­–ç•¥è§„åˆ™

    alt ç­–ç•¥å…è®¸
        Wukong->>Agent: ç›´æŽ¥æ‰§è¡Œ â†’ è¿”å›žç»“æžœ
    else ç­–ç•¥ä¸å…è®¸
        Wukong->>Xiezhi: è½¬å‘è¯·æ±‚ï¼ˆéœ€è¦å®¡æ‰¹ï¼‰
        Xiezhi->>Human: æŽ¨é€å®¡æ‰¹è¯·æ±‚
        Human->>Xiezhi: æ‰¹å‡†
        Xiezhi->>Xiezhi: ç”Ÿæˆ JIT åŠ¨æ€ç­–ç•¥
        Xiezhi->>Wukong: JIT ç­–ç•¥æŽ¨é€ + æ‰§è¡ŒæŽˆæƒ
        Wukong->>Agent: æ‰§è¡Œè¯·æ±‚ â†’ è¿”å›žç»“æžœ
    end
```

---

## ä¸‰ã€JIT åŠ¨æ€ç­–ç•¥

### 3.1 ä»€ä¹ˆæ˜¯ JIT ç­–ç•¥ï¼Ÿ

JITï¼ˆJust-In-Timeï¼‰åŠ¨æ€ç­–ç•¥æ˜¯å®¡æ‰¹é€šè¿‡åŽç”Ÿæˆçš„ä¸´æ—¶æŽˆæƒå‡­è¯ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š
- **ä¸´æ—¶æ€§**ï¼šæœ‰æ˜Žç¡®çš„æœ‰æ•ˆæœŸ
- **ä¸€æ¬¡æ€§**ï¼šé€šå¸¸åªå…è®¸å•æ¬¡æ‰§è¡Œ
- **ç»†ç²’åº¦**ï¼šå¯ä»¥ç²¾ç¡®åˆ°è¡Œçº§ã€åˆ—çº§
- **å¯è¿½æº¯**ï¼šå…³è”å®¡æ‰¹äººå’Œå®¡æ‰¹åŽŸå› 

### 3.2 ç­–ç•¥æ¨¡åž‹

```json
{
  "type": "jit_policy",
  "policy_id": "jit-20260217-001",
  "subject": "did:ziwei:agent:ai-007",
  "scope": {
    "resource": "database:customers",
    "rows": "region='US'",
    "columns": ["name", "email"]
  },
  "actions": ["read", "export"],
  "issued_at": "2026-02-17T10:00:00Z",
  "expires_at": "2026-02-17T11:00:00Z",
  "context": {
    "approved_by": "did:human:alice",
    "reason": "å­£åº¦æ•°æ®æ¸…æ´—ä»»åŠ¡",
    "request_id": "cheq-xxx"
  }
}
```

### 3.3 å­—æ®µè¯´æ˜Ž

| å­—æ®µ | ç±»åž‹ | è¯´æ˜Ž |
|------|------|------|
| policy_id | string | ç­–ç•¥å”¯ä¸€æ ‡è¯† |
| subject | DID | è¢«æŽˆæƒçš„ Agent DID |
| scope.resource | string | ç›®æ ‡èµ„æº |
| scope.rows | string | è¡Œçº§è¿‡æ»¤æ¡ä»¶ï¼ˆSQL WHEREï¼‰ |
| scope.columns | array | å…è®¸è®¿é—®çš„åˆ— |
| actions | array | å…è®¸çš„æ“ä½œ |
| expires_at | timestamp | è¿‡æœŸæ—¶é—´ |
| context.approved_by | DID | å®¡æ‰¹äºº DID |
| context.request_id | string | å…³è”çš„ CHEQ ID |

---

## å››ã€æ‚Ÿç©ºæ‹¦æˆªå™¨çš„è§’è‰²

### 4.1 æ ¸å¿ƒèŒè´£

| èŒè´£ | è¯´æ˜Ž |
|------|------|
| **ç­–ç•¥æŽ¥æ”¶** | æŽ¥æ”¶å¹¶å­˜å‚¨ç¬è±¸ä¸‹å‘çš„ç­–ç•¥è§„åˆ™ |
| **æœ¬åœ°è¯„ä¼°** | æ ¹æ®æœ¬åœ°ç­–ç•¥å¿«é€Ÿåˆ¤æ–­è¯·æ±‚æ˜¯å¦å…è®¸ |
| **ç­–ç•¥å†…æ”¾è¡Œ** | è¯·æ±‚åœ¨ç­–ç•¥å…è®¸èŒƒå›´å†…ï¼Œç›´æŽ¥æ‰§è¡Œ |
| **ç­–ç•¥å¤–è½¬å‘** | è¯·æ±‚è¶…å‡ºç­–ç•¥èŒƒå›´ï¼Œè½¬å‘ç»™ç¬è±¸ |
| **ä»»åŠ¡æŒ‚èµ·** | å®¡æ‰¹æœŸé—´æŒ‚èµ·ä»»åŠ¡ï¼Œå®¡æ‰¹é€šè¿‡åŽæ‰§è¡Œ |
| **JIT æ‰§è¡Œ** | æ”¶åˆ° JIT ç­–ç•¥åŽæ‰§è¡Œè¢«æŒ‚èµ·çš„è¯·æ±‚ |

### 4.2 æœ¬åœ°ç­–ç•¥è¯„ä¼°

```
è¯·æ±‚è¿›å…¥ â†’ æå–ä¸Šä¸‹æ–‡ â†’ åŒ¹é…ç­–ç•¥ â†’ è¿”å›žå†³ç­–
```

**å†³ç­–ç»“æžœ**ï¼š
- **Allow**ï¼šç­–ç•¥å…è®¸ï¼Œæ‰§è¡Œè¯·æ±‚
- **Deny**ï¼šç­–ç•¥æ‹’ç»ï¼Œè¿”å›žé”™è¯¯
- **Review**ï¼šç­–ç•¥ä¸æ˜Žç¡®ï¼Œè½¬å‘ç¬è±¸

### 4.3 ä»»åŠ¡æŒ‚èµ·æœºåˆ¶

å½“è¯·æ±‚éœ€è¦å®¡æ‰¹æ—¶ï¼Œæ‚Ÿç©ºæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

1. **ä¿å­˜è¯·æ±‚ä¸Šä¸‹æ–‡**
   - åŽŸå§‹è¯·æ±‚å†…å®¹
   - åˆ›å»ºæ—¶é—´
   - è¶…æ—¶æ—¶é—´

2. **è½®è¯¢å®¡æ‰¹çŠ¶æ€**
   - å®šæœŸæŸ¥è¯¢ç¬è±¸èŽ·å–å®¡æ‰¹çŠ¶æ€
   - æˆ–é€šè¿‡ WebSocket é•¿è¿žæŽ¥æŽ¥æ”¶æŽ¨é€

3. **å®¡æ‰¹é€šè¿‡åŽæ‰§è¡Œ**
   - æŽ¥æ”¶ JIT ç­–ç•¥
   - æ‰§è¡Œè¢«æŒ‚èµ·çš„è¯·æ±‚
   - æ¸…ç†æŒ‚èµ·è®°å½•

---

## äº”ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†

### 5.1 ç­–ç•¥ç”Ÿå‘½å‘¨æœŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   å®¡æ‰¹é€šè¿‡    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   æ‰§è¡Œå®Œæˆ    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¾…å®¡æ‰¹  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  JIT ç­–ç•¥ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ å·²å¤±æ•ˆ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â–²                        â”‚                        â”‚
     â”‚      å®¡æ‰¹æ‹’ç»/è¶…æ—¶      â”‚                        â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ç®¡ç†æœºåˆ¶

| é˜¶æ®µ | æ“ä½œ | å®žçŽ°æ–¹å¼ |
|------|------|---------|
| ç”Ÿæˆ | äººç±»å®¡æ‰¹é€šè¿‡åŽ | ç¬è±¸ç”Ÿæˆ JIT ç­–ç•¥ |
| ä¸‹å‘ | ç«‹å³æŽ¨é€ | HTTP/WebSocket |
| æ‰§è¡Œ | å®¡æ‰¹é€šè¿‡åŽ | æ‚Ÿç©ºæ‰§è¡ŒæŒ‚èµ·ä»»åŠ¡ |
| å¤±æ•ˆ | è¿‡æœŸè‡ªåŠ¨æ¸…é™¤ | æƒ°æ€§æ£€æŸ¥ + åŽå°æ¸…ç† |
| æ’¤é”€ | ä¸»åŠ¨æ’¤é”€ | åˆ é™¤ç­–ç•¥è®°å½• |

---

## å…­ã€ä¸ŽçŽ°æœ‰ç³»ç»Ÿçš„æ•´åˆ

### 6.1 ä¸Ž CHEQ çš„å…³ç³»

```
CHEQ å®¡æ‰¹é€šè¿‡ â†’ ç”Ÿæˆ JIT ç­–ç•¥ â†’ æŽ¨é€ç»™æ‚Ÿç©º â†’ æ‰§è¡ŒæŒ‚èµ·ä»»åŠ¡
```

CHEQ å®¡æ‰¹é€šè¿‡åŽï¼Œç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨æ ¹æ®å®¡æ‰¹ç»“æžœç”Ÿæˆ JIT åŠ¨æ€ç­–ç•¥ã€‚

### 6.2 ä¸Ž OPA/Cedar çš„æ•´åˆ

```rego
# OPA ç­–ç•¥ç¤ºä¾‹ï¼šæ£€æŸ¥ JIT ç­–ç•¥
package system_authz

# åŸºç¡€ç­–ç•¥
allow {
    input.action == "read"
    input.principal.role == "agent"
}

# JIT ç­–ç•¥æ£€æŸ¥
allow {
    some grant in data.jit_policies
    grant.subject == input.principal.did
    grant.actions[_] == input.action
    time.now_ns() >= grant.issued_at_ns
    time.now_ns() < grant.expires_at_ns
}
```

---

## ä¸ƒã€é€‰åž‹å»ºè®®

### ä¸ºä»€ä¹ˆé€‰æ‹© OPA è€Œéž Cedarï¼Ÿ

| ç‰¹æ€§ | OPA (Rego) | Cedar |
|------|-----------|-------|
| ç­–ç•¥ä¸Žæ•°æ®åˆ†ç¦» | âœ… åŽŸç”Ÿæ”¯æŒ | âŒ ç­–ç•¥å³ä»£ç  |
| åŠ¨æ€æ•°æ®æ›´æ–° | âœ… æ”¯æŒ Bundle API å¢žé‡æ›´æ–° | âŒ éœ€è¦é‡æ–°éƒ¨ç½² |
| è¡Œçº§è¿‡æ»¤ | âœ… å¯åœ¨ç­–ç•¥ä¸­è¿”å›ž | âœ… æ”¯æŒ |
| ç¤¾åŒºç”Ÿæ€ | âœ… äº‘åŽŸç”Ÿæ ‡å‡† | ðŸ”„ æ–°å…´ |
| æ€§èƒ½ | âœ… é«˜æ€§èƒ½ | âœ… é«˜æ€§èƒ½ |

**ç»“è®º**ï¼šOPA æ›´é€‚åˆ"ç­–ç•¥å³æ•°æ®"çš„åŠ¨æ€æŽˆæƒæ¨¡å¼ã€‚

---

## å…«ã€å¼€å‘ä»»åŠ¡

### Phase 1: æ‚Ÿç©ºæ‹¦æˆªå™¨

- [ ] ç­–ç•¥æŽ¥æ”¶æ¨¡å—
- [ ] æœ¬åœ°ç­–ç•¥è¯„ä¼°å¼•æ“Ž
- [ ] ä»»åŠ¡æŒ‚èµ·æœºåˆ¶
- [ ] è½®è¯¢/é•¿è¿žæŽ¥ç¬è±¸

### Phase 2: ç¬è±¸ç«¯

- [ ] JIT ç­–ç•¥ç”Ÿæˆ
- [ ] ç­–ç•¥ä¸‹å‘æŽ¨é€
- [ ] OPA é›†æˆ

### Phase 3: é«˜çº§åŠŸèƒ½

- [ ] è¡Œçº§è¿‡æ»¤çš„ SQL æ”¹å†™
- [ ] ç­–ç•¥ç¼“å­˜ä¼˜åŒ–
- [ ] ç›‘æŽ§å‘Šè­¦

---

## ä¹ã€ç›¸å…³æ–‡æ¡£

- [ç½‘å…³æ‹¦æˆªæµç¨‹è®¾è®¡-ææ¡ˆ.md](./ç½‘å…³æ‹¦æˆªæµç¨‹è®¾è®¡-ææ¡ˆ.md)
- [Matrixç«¯åˆ°ç«¯æµç¨‹è®¾è®¡-ææ¡ˆ.md](./Matrixç«¯åˆ°ç«¯æµç¨‹è®¾è®¡-ææ¡ˆ.md)
- [CHEQ-IETFè‰æ¡ˆ.md](../open/technical/CHEQ-IETFè‰æ¡ˆ.md)
- [é£Žé™©åˆ†æžå±‚æŠ€æœ¯æ–¹æ¡ˆ-ææ¡ˆ.md](./é£Žé™©åˆ†æžå±‚æŠ€æœ¯æ–¹æ¡ˆ-ææ¡ˆ.md)
