# 太白消息协议与交互方案 - 子任务拆分

## 提案：基于跨平台 IM 纯按钮交互方案的消息协议设计

### 背景

参考跨平台 IM 机器人"纯按钮交互"统一实施方案，设计太白模块的消息协议。

---

## 子任务清单

### T1: 统一点击事件模型定义

- [ ] 定义 action_key 命名规范
- [ ] 定义 action_value 结构
- [ ] 定义 message_id、user_id、timestamp 等通用字段
- [ ] 与现有 CHEQ 模型对接

**负责人**：待定
**优先级**：P0

---

### T2: 统一响应接口设计

- [ ] 定义 context.updateCard() 接口
- [ ] 定义 context.redirectUrl() 接口
- [ ] 实现 ResponseExecutor 抽象层
- [ ] 对接 Matrix 适配器

**负责人**：待定
**优先级**：P0

---

### T3: 太白卡片格式定义

- [ ] 定义 card_id 生成规则
- [ ] 定义 card_type 业务类型枚举
- [ ] 定义 title、content 字段
- [ ] 定义 components 按钮组件结构
- [ ] 定义 metadata 元信息结构

**负责人**：待定
**优先级**：P0

---

### T4: Matrix 适配层实现

- [ ] 实现 Matrix 卡片渲染
- [ ] 实现按钮点击事件接收
- [ ] 实现即时响应逻辑
- [ ] 与天枢路由层对接

**负责人**：待定
**优先级**：P1

---

### T5: 飞书适配层实现（预留）

- [ ] 飞书卡片渲染
- [ ] 飞书按钮回调接收
- [ ] API 调用型响应实现

**负责人**：待定
**优先级**：P2

---

### T6: 业务层对接

- [ ] 谛听审批结果对接
- [ ] Agent 就绪通知对接
- [ ] 消息路由逻辑调整

**负责人**：待定
**优先级**：P1

---

## 依赖关系

```
T1 (统一点击事件) 
    ↓
T2 (响应接口) ← T3 (卡片格式)
    ↓
T4 (Matrix 适配) → T6 (业务对接)
    ↓
T5 (飞书适配 - 预留)
```

---

## 实施顺序

1. 先完成 T1-T3（核心协议定义）
2. 再实现 T4（Matrix 适配，当前业务需要）
3. 最后 T6（业务对接）
4. T5 预留

---

## 待讨论事项

1. action_key 命名规范？
2. card_type 枚举值？
3. 与现有消息结构的兼容？
