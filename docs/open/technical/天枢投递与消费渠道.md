# 天枢投递与消费渠道（平台当前能力）

**版本**：v1.0  
**日期**：2026-02-16  
**目的**：约定天枢向 Agent 或用户**投递**指令/审批/通知的渠道，以及子项目**当前**如何接收（平台声明范围内仅此）。

---

## 1. 平台当前投递能力

- **审批请求投递**：谛听等调用 `POST /api/v1/delivery/approval-request`，天枢将审批请求发到配置的 **DELIVERY_ROOM_ID**（Matrix 房间）；请求体含 `request_id`、`title`、`description`、`trace_id`、`gateway_base_url` 等。
- **向 Agent 发消息**：天枢通过 `send_agent_message` 向某 Agent 的 Matrix Room 发送一条消息；子项目接入该 Room 即可收到事件。

---

## 2. 子项目当前如何接收（消费）

| 需求 | 做法 |
|------|------|
| 收「下发给我的指令/审批等」 | 接入该 Agent 的 **Matrix Room**，收天枢通过 `send_agent_message` 发来的消息；解析事件 body/msgtype 即得内容。 |
| 审批请求 | 谛听调 `POST /api/v1/delivery/approval-request`，天枢投递到 **DELIVERY_ROOM_ID**；用户/子项目在对应 Matrix 房间内看到审批消息。 |

当前仅通过 **Matrix 收消息**及上述投递接口完成「下发 → 接收」。

---

## 3. 投递消息的语义（payload）

经天枢投递到 Matrix 的消息可带语义类型（如 `approval_request`、`instruction`、`notification`），payload 与类型对应，例如：

- **approval_request**：`request_id`、`title`、`description`、`approve_url`、`reject_url` 等。
- **instruction**：`body`、`title` 等。

子项目解析事件时按 msgtype 或 payload 内 type 处理即可。

---

## 4. 引用

- 危险操作与 Matrix 审批验证：`ziwei/deploy/危险操作与Matrix审批验证.md`
- 原生渠道验证步骤：`ziwei/deploy/原生渠道验证步骤.md`
- 紫微平台各模块集成方案：`ziwei/docs/open/technical/紫微平台各模块集成方案.md`
