# 紫微主仓与文档基础约定

**版本**：v1.0  
**用途**：本仓库（及所有在 Cursor、Claude Code CLI、Codex 等环境中运行的 Agent）**必须遵循**的规约；与具体 IDE/CLI 无关。  
**统一入口**：各工具**默认加载根目录 `AGENTS.md`** 即可（其内容与本文档一致），无需每次指定路径；详见 `规约与多IDE约定.md`。

---

## 基础规范（必守）

- **子仓库均为 submodule**：天枢（tianshu）、谛听（diting）、太白（taibai）、**悟空（wukong）** 以及**源于 wukong 的子项目**在主仓中均以 **git submodule** 形式存在；子项目其余代码由子仓自行管理。
- **BMAD 文档按 BMAD 规范仍在子项目目录内**：各子项目的 BMAD 文档与产出（PRD、架构、Epics、`_bmad/`、`_bmad-output/planning-artifacts` 等）**依然按 BMAD 规范存放在该子项目目录下**（如 `tianshu/_bmad-output/`、`diting/_bmad/`），不挪到主仓根路径。
- **Git 层面**：子项目仓库在 `.gitignore` 中**忽略** `_bmad/`、`_bmad-output/`，不提交这些文档；**主仓**负责**跟踪并提交**各子项目下的 `_bmad/`、`_bmad-output/`（主仓的 .gitignore 配置为对子项目目录只跟踪这两类路径），从而实现「文档在子项目里、版本由主仓管」。

## 仓库与 Git

- **主仓（ziwei）**：推 NAS（`nas:/volume2/homes/hulk/git/ziwei.git`）；跟踪根目录 `docs/`、`_bmad/`、`_bmad-output/`，以及各子项目目录下的 `_bmad/`、`_bmad-output/`；子项目其余代码不进入主仓。
- **子项目**：统一在 GitHub 组织 ZiweiAxis 下（或约定之组织），仓库名与模块名一致；在主仓中为 **submodule**。子仓 `.gitignore` 中忽略 `_bmad/`、`_bmad-output/`，不在子仓提交 BMAD 文档。

## 文档归属（docs/）

- **根权威技术文档**：放在 `ziwei/docs/open/technical/`（如技术方案、架构图、BMAD 多子项目约定）。引用时使用路径 `ziwei/docs/open/technical/...`。
- **分类**：`open/`（technical、product、community、governance）、`business/`、`ip/`、`internal/`；详见 `docs/README.md`。
- **子项目敏感文档**：商业策划、BP、知识产权等从子仓迁移到紫微 `docs/business/`、`docs/ip/` 或 `docs/internal/`，子仓内可留占位「见紫微 docs/...」。

## 引用与一致性

- 子项目 PRD/架构/对齐文档**必须引用**根 `ziwei/docs/open/technical/紫微智能体治理基础设施-技术方案.md` 及根 planning-artifacts（若存在）；新建或修改根技术文档时放在 `docs/open/technical/`，并更新所有引用为 `ziwei/docs/open/technical/...`。

## 子项目任务与 Agent 调度

- **归属原则**：需在子项目内执行的任务（如 diting I-016～I-018、tianshu 对接 DID、taibai SDK 迭代），由**该子项目上下文下的 Agent 执行**，不在主仓 Agent 中代做子项目代码/配置修改。
- **自动调度**：根/紫微侧识别到任务属于某子模块时，应**调度子 Agent 执行**——即在对应子项目目录（`ziwei/diting`、`ziwei/tianshu`、`ziwei/taibai`、`ziwei/wukong` 及源于 wukong 的子项目）下启动或切换会话，使 Agent 在该子项目的规则、ISSUE_LIST 及**该子项目目录下的 `_bmad/`、`_bmad-output/`**（按 BMAD 规范）执行；上述 BMAD 文档在 Git 上由主仓跟踪，子仓不提交。根侧仅保留平台级决策、里程碑与联调约定。
- **BMAD 规范与角色**：子项目任务规划与执行须**按 BMAD 规范校验**，并在调度时**设置对应 BMAD 角色**（PM/Architect/Dev/QA/SM 等）与**工作流**（如 create-prd、create-architecture、dev-story、implementation-readiness）；详见 `docs/open/technical/子项目任务与Agent调度约定.md` §5。
- **实现方式**：可在根会话中明确产出「待子项目执行」的任务清单、验收条件、建议 BMAD 阶段与角色，由用户或自动化在子项目目录打开会话并以对应角色/工作流交付给子 Agent；若工具支持，可配置为按子项目路径自动路由到子 Agent。
