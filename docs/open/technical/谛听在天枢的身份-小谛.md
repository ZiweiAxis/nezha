# 獬豸在天枢的身份：「小谛」

**版本**：v1.0  
**日期**：2026-02-16  
**目的**：约定「獬豸在天枢拥有固定身份（小谛），与用户对话、发审批等均以此身份出现」的目标模型与现状差距。

---

## 1. 目标逻辑（应是）

- **獬豸在天枢有一个身份**：可命名为 **「小谛」**（或 `xiaodi` / `xiezhi` 等唯一标识）。
- **与用户对话、发审批等**：凡是獬豸触达用户的场景（审批请求、提醒、策略提示等），在用户侧**应显示为来自「小谛」**，而不是匿名网关或「天枢」。
- **统一发件人**：用户在与 Matrix/飞书等交互时，能明确知道「这是小谛（獬豸）在跟我说话」，与其它 Agent、天枢系统消息区分开。

---

## 2. 当前实现（不是）

| 项目 | 现状 |
|------|------|
| **Matrix 发件人** | 所有消息均由**天枢网关**一个账号发出（如 `@gateway:xyin.oicp.net`），没有单独的「小谛」账号或身份。 |
| **獬豸是否在天枢有身份** | 獬豸**未**在天枢身份体系内注册为固定服务身份；獬豸只是「调用天枢 API 的调用方」（如 `POST /api/v1/delivery/approval-request`），天枢用网关账号代为发信。 |
| **payload 中的来源** | 投递事件的 payload 可带语义字段，但当前未统一约定 `sender_display_id: "小谛"` 或等价字段，前端/客户端也未按「小谛」展示。 |

因此：**当前逻辑不是「獬豸以身份小谛与用户对话、发审批」**，而是「天枢网关统一代发，獬豸无独立可识别的身份」。

---

## 3. 建议补齐方向

1. **在天枢侧为獬豸登记固定身份**
   - 例如：预留或注册一个**服务身份**（如 `agent_id = "tianshu-service-xiezhi"` 或 display_id `"小谛"`），仅用于标识「獬豸」；不参与普通 Agent 的注册/心跳，仅用于发件人归属与审计。

2. **发信时体现「小谛」**
   - **方案 A**：为小谛单独申请一个 Matrix 账号（如 `@xiaodi:xyin.oicp.net`），獬豸触达用户的场景由天枢用该账号发消息（需天枢支持「代发时选择发件人」或獬豸持有该账号 token 经天枢转发）。
   - **方案 B**：继续用网关账号发信，但在**投递 payload 中统一带** `sender_id: "tianshu-service-xiezhi"`、`sender_display_name: "小谛"`，客户端/Element 展示时以「小谛」展示（需客户端或桥接层支持）。
   - **方案 C**：网关账号在「代獬豸发信」时使用 Matrix 的 displayname 或 profile 临时切为「小谛」（实现简单但多租户下易冲突，仅作过渡）。

3. **獬豸调用天枢投递 API 时**
   - 天枢在接收獬豸的审批请求等时，应能识别「调用方为獬豸」，并自动带上小谛身份（如上述 `sender_id` / `sender_display_name`），或路由到小谛对应的发件人账号。

4. **与现有身份体系一致**
   - 与「Agent 注册、owner、主从链」等并列，将「小谛」视为**平台服务身份**，在身份文档、审计日志中统一标注，便于排障与合规。

---

## 4. 小结

| 问题 | 结论 |
|------|------|
| 逻辑上獬豸在天枢是否应有身份「小谛」？ | **是**，应与用户对话、发审批等都以此身份出现。 |
| 当前是否已是这套逻辑？ | **否**，当前是网关统一发信，獬豸无独立身份。 |
| 下一步 | 在天枢侧为獬豸登记「小谛」服务身份，并在投递/发信路径上体现发件人为小谛（见 §3）。 |

**引用**：`紫微平台各模块集成方案.md`（审批触达：獬豸→天枢→IM）、`紫微智能体治理基础设施-技术方案.md` §2.4。
