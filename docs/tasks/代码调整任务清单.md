# 任务清单

## 一、架构调整完成状态

| 阶段 | 任务 | 状态 |
|------|------|------|
| Phase 1 | 方案确认 | ✅ 完成 |
| Phase 2 | 谛听独立化 | ✅ 完成 |
| Phase 3 | 天枢清理 | ✅ 完成 |
| Phase 4 | 调用统一 | ✅ 完成 |

---

## 二、紫微模块依赖关系

### 2.1 正确的依赖关系

```
         ┌─────────────────────────────────────┐
         │              獬豸                       │
         │         (策略决策服务端)                 │
         └──────────────────┬────────────────────┘
                          ▲
                          │ 谛听调用獬豸
                          │ (HTTP)
         ┌────────────────┴────────────────┐
         │                                   │
    ┌────┴────┐                      ┌──────┴──────┐
    │   谛听   │                      │ 太白 SDK     │
    │ (PEP)   │                      │ (天枢客户端)  │
    └────┬────┘                      └──────┬──────┘
         │                                   │
    哪吒调用谛听                         天枢调用太白
         │                                   │
    ┌────┴────┐                      ┌──────┴──────┐
    │   哪吒   │                      │    天枢     │
    │ (Agent) │                      │ (消息中枢)   │
    └─────────┘                      └─────────────┘
```

### 2.2 依赖总结

| 模块 | 依赖谁 | 被谁依赖 |
|------|--------|----------|
| **獬豸** | - | 谛听 |
| **谛听** | 獬豸 | 哪吒 |
| **哪吒** | 谛听、太白 | - |
| **太白** | 天枢 | 哪吒、獬豸 |
| **天枢** | - | 太白 |

### 2.3 调用协议

| 调用路径 | 协议 | 说明 |
|----------|------|------|
| 哪吒 → 谛听 | HTTP | 策略拦截请求 |
| 谛听 → 獬豸 | HTTP | 获取策略决策 |
| 獬豸 → 天枢 | 太白 SDK | 审批消息投递 |
| 哪吒 → 天枢 | 太白 SDK | 消息发送 |

---

## 三、模块职责

| 模块 | 职责 | 角色 |
|------|------|------|
| **哪吒** | Agent 生命周期管理 | 调用方 |
| **獬豸** | 策略决策 + 审批服务 | 服务端 |
| **天枢** | 消息中枢 | 服务端 |
| **太白** | 天枢 SDK | 客户端库 |
| **谛听** | PEP 策略执行点 | 獬豸的客户端 |

---

## 四、后续开发任务

### 4.1 待完成

| 任务 | 模块 | 优先级 | 说明 |
|------|------|--------|------|
| **T1** | 太白 | P0 | Go/Python SDK 实现 |
| **T2** | 谛听 | P1 | Seccomp 拦截实现 |
| **T3** | 獬豸 | P1 | 使用太白 SDK |
| **T4** | 哪吒 | P1 | 使用太白 SDK |
| **T5** | 谛听 | P2 | import 路径修复 |

### 4.2 任务详情

#### T1: 太白 SDK 开发

- [ ] Go SDK 实现
  - [ ] HTTP 客户端
  - [ ] WebSocket 客户端
  - [ ] 消息发送 API
  - [ ] 用户/房间管理 API
- [ ] Python SDK 实现
- [ ] 集成测试

#### T2: 谛听 Seccomp 方案实现

- [ ] Seccomp 通知处理
- [ ] 策略缓存
- [ ] 请求队列
- [ ] 与獬豸通信（调用獬豸）
- [ ] 审批回调

#### T3: 獬豸改造

- [ ] 集成太白 SDK
- [ ] 使用太白 SDK 调用天枢
- [ ] 测试验证

#### T4: 哪吒改造

- [ ] 集成谛听客户端
- [ ] 集成太白 SDK
- [ ] 测试验证

#### T5: 谛听 go.mod

- [ ] 创建独立项目配置
- [ ] 更新 import 路径

---

## 五、模块代码位置

```
ziwei/
├── nezha/           # 哪吒 - Agent 生命周期管理
│   └── src/clients/DitingClient.ts  # 谛听客户端
│
├── xiezhi/          # 獬豸 - 策略服务 + 审批服务
│
├── tianshu/         # 天枢 - 消息中枢
│   └── src/taibai/  # 太白客户端 (Python)
│
├── taibai/          # 太白 - SDK (待开发)
│
└── diting/         # 谛听 - PEP (新独立项目)
```

---

## 六、Git 仓库

| 模块 | 仓库 | 说明 |
|------|------|------|
| 主仓 | ziwei | 包含文档 |
| 哪吒 | ZiweiAxis/nezha | Agent 管理 |
| 獬豸 | ZiweiAxis/xiezhi | 策略服务 |
| 天枢 | ZiweiAxis/tianshu | 消息中枢 |
| 太白 | ZiweiAxis/taibai | SDK |
| 谛听 | ZiweiAxis/diting | PEP |
