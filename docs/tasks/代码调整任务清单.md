# 任务清单

## 一、架构调整完成状态

| 阶段 | 任务 | 状态 |
|------|------|------|
| Phase 1 | 方案确认 | ✅ 完成 |
| Phase 2 | 谛听独立化 | ✅ 完成 |
| Phase 3 | 天枢清理 | ✅ 完成 |
| Phase 4 | 调用统一 | ✅ 完成 |

---

## 二、紫微模块依赖关系

### 2.1 模块调用关系

```
┌──────────────┐     HTTP      ┌──────────────┐
│    哪吒     │ ───────────▶ │    獬豸     │
│   (Agent)   │   策略请求    │   (策略+审批) │
└──────┬───────┘              └──────┬───────┘
       │                               │
       │ 太白 SDK                      │ 太白 SDK
       ▼                               ▼
┌──────────────┐              ┌──────────────┐
│    天枢     │◀────────────│    天枢     │
│  (消息中枢)  │  审批消息投递  │  (消息中枢)  │
└──────────────┘              └──────────────┘
       ▲
       │ (可选)
       │
┌──────────────┐
│    谛听     │
│  (PEP)      │
└──────────────┘
```

### 2.2 模块职责与依赖

| 模块 | 职责 | 依赖方 | 依赖 |
|------|------|--------|------|
| **哪吒** | Agent 生命周期管理 | 獬豸、太白 | 策略决策、消息投递 |
| **獬豸** | 策略决策 + 审批 | 哪吒、太白 | 消息投递 |
| **天枢** | 消息中枢 | 哪吒、獬豸 | - |
| **太白** | 天枢 SDK | 哪吒、獬豸 | - |
| **谛听** | PEP 策略执行 | 獬豸 | 策略决策 |

### 2.3 调用协议

| 调用路径 | 协议 | 说明 |
|----------|------|------|
| 哪吒 → 獬豸 | HTTP | 策略请求 |
| 獬豸 → 天枢 | 太白 SDK | 审批消息投递 |
| 哪吒 → 天枢 | 太白 SDK | 消息发送 |
| 獬豸 → 谛听 | HTTP | 策略下发 |
| 谛听 → 獬豸 | HTTP | 策略请求 |

---

## 三、后续开发任务

### 3.1 待完成

| 任务 | 模块 | 优先级 | 说明 |
|------|------|--------|------|
| **T1** 太白 SDK 开发 | 太白 | P0 | Go/Python SDK 实现 |
| **T2** 谛听 Seccomp 方案实现 | 谛听 | P1 | Seccomp 拦截 |
| **T3** 獬豸改造使用太白 SDK | 獬豸 | P1 | 替换直接 HTTP 调用 |
| **T4** 哪吒改造使用太白 SDK | 哪吒 | P1 | 替换直接 HTTP 调用 |
| **T5** 谛听 go.mod 修复 | 谛听 | P2 | 更新 import 路径 |

### 3.2 任务详情

#### T1: 太白 SDK 开发

- [ ] Go SDK 实现
  - [ ] HTTP 客户端
  - [ ] WebSocket 客户端
  - [ ] 消息发送 API
  - [ ] 用户管理 API
  - [ ] 房间管理 API
- [ ] Python SDK 实现（同上）
- [ ] 集成测试

#### T2: 谛听 Seccomp 方案实现

- [ ] Seccomp 通知处理
- [ ] 策略缓存
- [ ] 请求队列
- [ ] 与獬豸通信
- [ ] 审批回调

#### T3: 獬豸改造

- [ ] 移除直接 HTTP 调用天枢
- [ ] 集成太白 SDK
- [ ] 测试验证

#### T4: 哪吒改造

- [ ] 移除直接 HTTP 调用天枢
- [ ] 集成太白 SDK
- [ ] 测试验证

#### T5: 谛听 go.mod 修复

- [ ] 创建 `diting/go.mod`
- [ ] 更新 import 路径
- [ ] 验证构建

---

## 四、模块代码位置

```
ziwei/
├── nezha/           # 哪吒 - Agent 生命周期管理
│   └── src/clients/DitingClient.ts  # 谛听客户端 (TypeScript)
│
├── xiezhi/          # 獬豸 - 策略服务 + 审批服务
│   ├── cmd/diting/  # 谛听旧代码 (待清理)
│   └── internal/delivery/tianshu/   # 天枢投递客户端
│
├── tianshu/         # 天枢 - 消息中枢
│   └── src/taibai/  # 太白客户端 (Python)
│
├── taibai/          # 太白 - SDK (待开发)
│   └── sdk/         # SDK 代码
│
└── diting/          # 谛听 - PEP (新独立项目)
    ├── cmd/         # 入口
    ├── pkg/         # 包
    └── internal/   # 内部
```

---

## 五、Git 仓库

| 模块 | 仓库 | 说明 |
|------|------|------|
| 主仓 | ziwei | 包含文档和子项目引用 |
| 哪吒 | ZiweiAxis/nezha | Agent 管理 |
| 獬豸 | ZiweiAxis/xiezhi | 策略服务 |
| 天枢 | ZiweiAxis/tianshu | 消息中枢 |
| 太白 | ZiweiAxis/taibai | SDK |
| 谛听 | ZiweiAxis/diting | PEP (新) |
