# 开发计划

## 一、任务依赖分析

### 1.1 任务关系图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         太白 SDK 开发 (T1)                            │
│                    (Go + Python 两个版本)                            │
└─────────────────────────────┬───────────────────────────────────────┘
                              │
              ┌───────────────┴───────────────┐
              ▼                               ▼
    ┌───────────────────┐           ┌───────────────────┐
    │   獬豸改造 (T2)   │           │   哪吒改造 (T4)   │
    │ - 移除直接调用     │           │ - 集成谛听客户端  │
    │ - 集成太白 SDK    │           │ - 集成太白 SDK    │
    └─────────┬─────────┘           └─────────┬─────────┘
              │                               │
              ▼                               ▼
    ┌─────────────────────────────────────────────────────────────┐
    │                    谛听 Seccomp 实现 (T3)                 │
    │  - 与獬豸通信（调用獬豸获取策略决策）                │
    │  - Seccomp 拦截                                      │
    └─────────────────────────────────────────────────────┘
```

### 1.2 关键路径

**路径1**：T1(太白) → T2(獬豸) → T3(谛听)
**路径2**：T1(太白) → T4(哪吒)

---

## 二、任务拆分

### T1: 太白 SDK 开发

| 子任务 | 说明 | 优先级 | 可并行 |
|--------|------|--------|--------|
| T1.1 | Go SDK - HTTP 客户端 | P0 | ✅ |
| T1.2 | Go SDK - WebSocket 客户端 | P0 | ✅ |
| T1.3 | Go SDK - 消息发送 API | P0 | |
| T1.4 | Go SDK - 用户/房间管理 API | P0 | |
| T1.5 | Go SDK - 审批消息投递 API | P0 | 关键 |
| T1.6 | Python SDK (同 T1.1-T1.5) | P1 | ✅ |
| T1.7 | SDK 集成测试 | P0 | |

**依赖**：无

---

### T2: 獬豸改造

| 子任务 | 说明 | 优先级 | 可并行 |
|--------|------|--------|--------|
| T2.1 | 移除 `internal/delivery/tianshu/` 直接调用 | P1 | |
| T2.2 | 集成太白 Go SDK | P1 | |
| T2.3 | 使用太白 SDK 投递审批消息 | P1 | |
| T2.4 | 测试验证 | P1 | |

**依赖**：T1.5 (太白审批 API) → T2

---

### T3: 谛听 Seccomp 实现

| 子任务 | 说明 | 优先级 | 可并行 |
|--------|------|--------|--------|
| T3.1 | Seccomp 通知处理核心 | P1 | ✅ |
| T3.2 | Syscall 参数解析 | P1 | ✅ |
| T3.3 | 本地策略缓存 | P1 | ✅ |
| T3.4 | 请求队列管理 | P1 | ✅ |
| T3.5 | 与獬豸 HTTP 通信 | P1 | |
| T3.6 | 审批回调机制 | P1 | |
| T3.7 | 集成测试 | P1 | |

**依赖**：T2 (獬豸提供决策 API)

---

### T4: 哪吒改造

| 子任务 | 说明 | 优先级 | 可并行 |
|--------|------|--------|--------|
| T4.1 | 集成谛听客户端 | P1 | |
| T4.2 | 集成太白 Go SDK | P1 | |
| T4.3 | Agent 启动时注入 Seccomp | P1 | |
| T4.4 | 测试验证 | P1 | |

**依赖**：T1 (太白 SDK) + T3 (谛听实现)

---

## 三、开发计划

### Phase 1: 基础设施 (可并行)

```
时间 →

T1.1 Go HTTP ──► T1.3 消息 ──► T1.7 测试
T1.2 Go WS  ──► T1.4 用户 ──┘
T1.5 审批  ◄──────────────┘
                  
T1.6 Python (并行)
```

| 周次 | 任务 | 产出 |
|------|------|------|
| 第1周 | T1.1-T1.3 | Go SDK 基础功能 |
| 第2周 | T1.4-T1.5 | Go SDK 完整功能 |
| 第3周 | T1.6-T1.7 | Python SDK + 测试 |

---

### Phase 2: 獬豸改造 (串行)

```
T1.5 完成后 → T2.1 → T2.2 → T2.3 → T2.4
```

| 周次 | 任务 | 产出 |
|------|------|------|
| 第4周 | T2.1-T2.2 | 移除直接调用，集成 SDK |
| 第5周 | T2.3-T2.4 | 审批消息功能 + 测试 |

---

### Phase 3: 谛听实现 (可并行)

```
T2 完成后 → T3.1-T3.4 (并行) → T3.5-T3.7
```

| 周次 | 任务 | 产出 |
|------|------|------|
| 第6周 | T3.1-T3.4 | 核心功能 |
| 第7周 | T3.5-T3.7 | 通信 + 测试 |

---

### Phase 4: 哪吒改造 (串行)

```
T1 + T3 完成后 → T4.1 → T4.2 → T4.3 → T4.4
```

| 周次 | 任务 | 产出 |
|------|------|------|
| 第8周 | T4.1-T4.2 | 集成客户端 |
| 第9周 | T4.3-T4.4 | Seccomp 注入 + 测试 |

---

## 四、总结

### 开发周期

| Phase | 内容 | 周数 |
|-------|------|------|
| Phase 1 | 太白 SDK | 3周 |
| Phase 2 | 獬豸改造 | 2周 |
| Phase 3 | 谛听实现 | 2周 |
| Phase 4 | 哪吒改造 | 2周 |

**总计：约 9 周**

### 可并行任务

| 并行组 | 任务 |
|--------|------|
| 组1 | T1.1, T1.2, T1.6 |
| 组2 | T3.1, T3.2, T3.3, T3.4 |

### 关键里程碑

| 里程碑 | 任务 | 预期 |
|--------|------|------|
| M1 | T1.5 完成 | 獬豸可开始改造 |
| M2 | T2.4 完成 | 审批流程可用 |
| M3 | T3.7 完成 | 谛听拦截可用 |
| M4 | T4.4 完成 | 完整流程打通 |
