# 紫微主仓与子项目 BMAD 一致性检查报告

**执行角色**：PM Agent（按 BMAD 机制）  
**检查日期**：2026-02-16  
**范围**：ziwei 主仓、子项目（tianshu、diting、taibai、wukong）的 BMAD 配置与代码层面引用一致性。

---

## 1. 检查依据

- **根约定**：`.cursor/rules/ziwei-repo-and-docs.mdc`（主仓与文档、子项目 BMAD 跟踪）
- **子项目调度与 BMAD**：`docs/open/technical/子项目任务与Agent调度约定.md` §5（规范校验、角色、工作流）
- **多子项目 BMAD**：`docs/open/technical/BMAD-多子项目管理-最佳实践.md`（每子项目一套 _bmad、根与子产出物引用）

---

## 2. BMAD 安装与存在性

| 项目 | _bmad 存在 | _bmad-output 存在 | 说明 |
|------|------------|-------------------|------|
| **ziwei（主仓）** | ✅ | ✅ | 完整 core + bmm，version 6.0.0-Beta.8 |
| **taibai** | ✅ | ✅ | 完整，同版本，project_name: taibai |
| **wukong** | ✅ | ✅ | 完整，同版本，project_name: wukong |
| **tianshu** | ✅ | ✅ | 本地有完整 _bmad、_bmad-output；子仓 .gitignore 忽略，由主仓跟踪 |
| **diting** | ✅ | ✅ | 同上；BMAD 文档按规范在子项目目录内，Git 由主仓跟踪 |

**结论**：BMAD 文档按规范仍在各子项目目录内；子仓不提交 _bmad/_bmad-output，由主仓跟踪。tianshu、diting 在本地具备 _bmad，可在子项目目录下以 BMAD 角色/工作流执行。

---

## 3. BMAD 配置一致性（有 _bmad 的仓）

### 3.1 版本与 manifest

- **版本**：主仓、taibai、wukong 均为 `6.0.0-Beta.8`，一致。
- **manifest ides**：主仓 `cursor, claude-code, codex`；taibai 仅 `cursor`；wukong `claude-code, codex, cursor`。

### 3.2 bmm/config.yaml

| 项 | ziwei | taibai | wukong |
|----|-------|--------|--------|
| project_name | ziwei | taibai | wukong |
| planning_artifacts | {project-root}/_bmad-output/planning-artifacts | 同左 | 同左 |
| implementation_artifacts | {project-root}/_bmad-output/implementation-artifacts | 同左 | 同左 |
| project_knowledge | {project-root}/docs | 同左 | 同左 |
| output_folder | {project-root}/_bmad-output | 同左 | 同左 |
| communication_language | English | English | **中文** |
| user_name | Dministrator | Dministrator | Dministrator |

差异：wukong 使用中文为沟通语言，可为子项目本地偏好，非错误。

### 3.3 已修复的配置笔误（代码层面）

- **问题**：`document-project/workflows/deep-dive.yaml` 与 `full-scan.yaml` 中 `config_source` 写为 `{project-root}/_bmad/**bmb**/config.yaml`（应为 `bmm`）。
- **影响**：document-project 子工作流加载配置时会找错路径。
- **处理**：已在主仓、taibai、wukong 共 6 处全部改为 `_bmad/bmm/config.yaml`。

---

## 4. Agent 与工作流结构

- **主仓**：`_bmad/bmm/agents/` 含 pm、dev、architect、analyst、ux-designer、sm、qa、quick-flow-solo-dev（8 个）；workflows 含 1-analysis、2-plan-workflows、3-solutioning、4-implementation、document-project、bmad-quick-flow、qa 等，与 BMAD 四阶段一致。
- **taibai**：agents 与主仓一致（8 个）；workflows 目录结构与主仓一致（169 个文件），具备 create-prd、create-epics-and-stories、check-implementation-readiness、dev-story 等。
- **wukong**：除上述 8 个外另有 `tech-writer`；workflows 更全（含 2-plan create-prd 等完整步骤），与主仓一致。

---

## 5. 文档与根技术方案引用（代码/文档层面）

### 5.1 引用路径规范

- **约定**：子项目 PRD/架构/对齐文档须引用 `ziwei/docs/open/technical/紫微智能体治理基础设施-技术方案.md`，路径形式为 `ziwei/docs/open/technical/...`。

### 5.2 检查结果

- **已统一**：diting ISSUE_LIST、tianshu design-alignment-with-ziwei.md、tianshu README、taibai README、taibai docs（P1-协议与文档对齐、协议与SDK说明、Claude-Code-CLI对接说明）、根 _bmad-output 与 .cursor/agents 等，多数已使用 `ziwei/docs/open/technical/...`。
- **可移植性**：✅ 已修正（2026-02-16）：taibai 内原绝对路径已改为 `ziwei/docs/open/technical/...`（adapter-development-guide.md、adapters/claude_code_cli/README.md、_bmad-output/planning-artifacts/ADR-001-...）。

### 5.3 代码中 _bmad / _bmad-output / ISSUE_LIST

- **结果**：未在业务代码（.py、.ts、.js）中发现对 `_bmad`、`_bmad-output` 或 `ISSUE_LIST` 的硬编码引用；仅 _bmad 内部 yaml 使用 `{project-root}/_bmad/...`，符合预期。

---

## 6. 与子项目调度约定的对齐情况

| 约定项 | 状态 |
|--------|------|
| 子项目 PRD/架构须引用根技术方案 | ✅ 已引用（路径多数正确） |
| 子项目任务在子项目 _bmad、ISSUE_LIST 下由子 Agent 执行 | ✅ tianshu、diting 本地有 _bmad，BMAD 文档由主仓跟踪 |
| 调度时设置 BMAD 角色（PM/Architect/Dev/QA/SM） | ✅ 主仓、taibai、wukong 均有对应 agents |
| 产出物落子项目 _bmad-output/ 或约定位置 | ✅ 有 _bmad 的子项目具备 _bmad-output |

---

## 7. 建议与后续动作

1. **tianshu、diting**  
   本地已有 _bmad/_bmad-output；子仓 .gitignore 忽略，主仓跟踪。无需重复安装；新 clone 主仓后子项目目录下 _bmad 由主仓检出。

2. **taibai 文档路径可移植性**  
   ✅ 已完成（2026-02-16）：绝对路径已改为 `ziwei/docs/open/technical/...`。

3. **已完成的修复**  
   - document-project 下 `config_source` 笔误（bmb→bmm）已在主仓、taibai、wukong 全部修正。  
   - 根目录统一 Agent 文档 **AGENTS.md** 已建立；规约与多 IDE 约定见 `docs/open/technical/规约与多IDE约定.md`。

4. **可选**  
   - 统一 manifest 的 ides 列表（若希望各子项目 IDE 体验一致）。  
   - 明确 wukong 的 communication_language 为「子项目本地偏好」并在文档中说明。

---

*本报告由 PM Agent 按 BMAD 机制执行一致性检查后产出，供根与子项目规划及实现就绪使用。*
