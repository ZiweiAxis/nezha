# 紫微项目任务拆解 (Task Breakdown)

## 任务管理规范

### 看板状态
- [ ] 待办 (Todo)
- [ ] 进行中 (In Progress)
- [ ] 待验收 (Pending Review)  
- [ ] 已完成 (Done)

---

## Epic 1: 獬豸服务端开发

### Task 1.1: 獬豸服务端基础框架
| ID | 任务 | 交付件 | 状态 |
|----|------|--------|------|
| 1.1.1 | 搭建 Go 项目结构 | Go 模块初始化 | [ ] |
| 1.1.2 | 实现 HTTP API 框架 | Gin 服务 | [ ] |
| 1.1.3 | 集成日志模块 | 日志配置 | [ ] |

**交付**: 可运行的 HTTP 服务

---

### Task 1.2: 策略引擎
| ID | 任务 | 交付件 | 状态 |
|----|------|--------|------|
| 1.2.1 | 策略存储模型设计 | MySQL 表结构 | [ ] |
| 1.2.2 | 策略 CRUD API | REST API | [ ] |
| 1.2.3 | 策略加载与缓存 | 缓存模块 | [ ] |

**交付**: 策略管理 API

---

### Task 1.3: 决策引擎
| ID | 任务 | 交付件 | 状态 |
|----|------|--------|------|
| 1.3.1 | 决策 API | /decide 接口 | [ ] |
| 1.3.2 | 规则匹配器 | 匹配逻辑 | [ ] |
| 1.3.3 | 决策结果返回 | Response Model | [ ] |

**交付**: 决策接口

---

### Task 1.4: 审批模块 (CHEQ)
| ID | 任务 | 交付件 | 状态 |
|----|------|--------|------|
| 1.4.1 | 审批单数据模型 | CHEQ 结构 | [ ] |
| 1.4.2 | 创建审批单 API | POST /cheq | [ ] |
| 1.4.3 | 审批通过/拒绝 API | POST /cheq/approve | [ ] |

**交付**: 审批管理接口

---

## Epic 2: 客户端 SDK

### Task 2.1: 獬豸客户端 SDK
| ID | 任务 | 交付件 | 状态 |
|----|------|--------|------|
| 2.1.1 | Go 客户端库封装 | Client SDK | [ ] |
| 2.1.2 | 请求拦截器实现 | Interceptor | [ ] |
| 2.1.3 | 策略缓存模块 | Cache 模块 | [ ] |

**交付**: Go SDK 包

---

### Task 2.2: 太白客户端 SDK
| ID | 任务 | 交付件 | 状态 |
|----|------|--------|------|
| 2.2.1 | Python SDK 封装 | Python SDK | [ ] |
| 2.2.2 | 消息发送接口 | send_message() | [ ] |

**交付**: Python SDK 包

---

## Epic 3: 天枢服务

### Task 3.1: 天枢基础服务
| ID | 任务 | 交付件 | 状态 |
|----|------|--------|------|
| 3.1.1 | 搭建 Node.js 项目 | 项目初始化 | [ ] |
| 3.1.2 | 消息路由模块 | Router | [ ] |
| 3.1.3 | 身份管理模块 | Identity Service | [ ] |

**交付**: 消息路由服务

---

### Task 3.2: IM 渠道对接
| ID | 任务 | 交付件 | 状态 |
|----|------|--------|------|
| 3.2.1 | Matrix 适配器 | Matrix Adapter | [ ] |
| 3.2.2 | 飞书适配器 | Feishu Adapter | [ ] |
| 3.2.3 | 消息格式转换 | Format Converter | [ ] |

**交付**: IM 渠道对接

---

## Epic 4: 集成测试

### Task 4.1: 端到端测试
| ID | 任务 | 交付件 | 状态 |
|----|------|--------|------|
| 4.1.1 | Agent 注册流程测试 | 测试用例 | [ ] |
| 4.1.2 | 操作审批流程测试 | 测试用例 | [ ] |
| 4.1.3 | 消息投递测试 | 测试用例 | [ ] |

**交付**: 测试报告

---

## 任务依赖关系图

```
Epic 1: 獬豸服务端
├── 1.1 基础框架
│   └── 1.2 策略引擎
│       └── 1.3 决策引擎
│           └── 1.4 审批模块

Epic 2: 客户端 SDK
├── 2.1 獬豸客户端 SDK
└── 2.2 太白客户端 SDK

Epic 3: 天枢服务
├── 3.1 基础服务
│   └── 3.2 IM 渠道

Epic 4: 集成测试
└── 4.1 E2E 测试 ← 依赖 1.x + 2.x + 3.x
```

## 交付件检查清单

每个子任务完成需更新:
- [ ] 代码提交到仓库
- [ ] 单元测试覆盖
- [ ] API 文档更新
- [ ] 本清单状态标记

---

## 实施优先级

| 优先级 | Epic | 理由 |
|--------|------|------|
| P0 | Epic 1 | 核心服务，无则无法运行 |
| P1 | Epic 2 | 客户端 SDK，被依赖 |
| P2 | Epic 3 | 消息服务，可后续集成 |
| P3 | Epic 4 | 测试，完成核心后验证 |
