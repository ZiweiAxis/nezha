# 测试用 Agent 能力与验证约定

**目的**：约定端到端验证所需的「测试用 Agent」能力，以及太白、天枢、獬豸三者的职责边界。

---

## 1. 平台层职责（详见《紫微平台层职责梳理》）

- **太白核心**：**联络 Agent 与天枢**。接收天枢传来的信息、转发给 Agent；Agent 按天枢规范输出、回传天枢。太白不处理执行、不实现监听逻辑。
- **獬豸**：**一套机制，达到监听的效果**。提供策略、鉴权（如 `/auth/exec`）、代理、CHEQ、审计、存证等机制，使智能体的执行与工具调用**可被监听**（可拦截、可审批、可审计）。獬豸**不执行**业务逻辑；执行在 Agent 侧。
- **天枢**：通信枢纽、身份与路由；指令经天枢下发给 Agent（经太白联络），Agent 的响应按天枢规范经太白回传天枢。

---

## 2. 当前测试用 Agent（verification_agent）

- **verification_agent**（`taibai/examples/verification_agent/main.py`）：通过太白 SDK 与天枢联络，做发现、注册、心跳及可选上报。无脚本执行、无工具调用、无大模型，仅用于**接入与心跳**的端到端验证。
- **后续要验证的链路**：用户指令 → 天枢 →（经太白联络）→ Agent → Agent 执行脚本或调用工具 → 经**獬豸机制**达到监听效果（鉴权/审批/审计）→ 结果回传。执行在 Agent 侧；獬豸提供机制，达到监听效果。

---

## 3. 用于验证「执行+工具」的测试 Agent 应具备的能力

此类测试 Agent 可以是任意实现（含大模型 + 工具），**不要求由太白实现业务逻辑**；只需通过太白（SDK/协议）与天枢联络，并按天枢规范回传。执行在 Agent；执行与工具调用时经**獬豸机制**达到监听效果。

| 能力 | 说明 | 职责归属 |
|------|------|----------|
| **与天枢联络** | 发现、注册、心跳；接收天枢下发的指令，按天枢规范回传结果。 | **太白**（SDK/协议） |
| **大模型对接** | 接收指令、生成推理与工具调用决策。 | Agent 自身实现 |
| **脚本执行** | 执行在 Agent；执行前经獬豸机制（如 `POST /auth/exec`）达到监听效果，allow 则执行，review 则走 CHEQ。 | 执行在 Agent；獬豸提供机制，达到监听效果 |
| **工具调研（网络请求）** | 以工具形式发起 HTTP 请求；可选流量经獬豸代理，经獬豸机制达到监听效果。 | 调用在 Agent；獬豸提供机制，达到监听效果 |

---

## 4. 实现与验证口径

- **联络层**：由太白提供 SDK 与协议（发现、注册、心跳、收发格式），Agent 使用太白与天枢对接。
- **测试用 Agent 本体**（含 LLM + 脚本执行 + 网络请求工具）：可在太白仓库中以示例形式提供，或由其他模块/团队实现，只要通过太白与天枢联络、执行/工具调用时走獬豸即可。
- **验证口径**：
  1. 用户下发「执行某命令」→ 天枢 →（太白转发）→ Agent → Agent 请求獬豸 `/auth/exec` → 獬豸 review 时审批 → 批准后 Agent 执行并回传天枢。
  2. 用户下发「查某 URL」→ 天枢 →（太白转发）→ Agent → Agent 以工具发起网络请求，经獬豸机制达到监听效果 → 结果回传天枢。

---

## 5. 与现有组件的对应关系

- **天枢**：发现、注册、心跳、指令下发与结果汇聚（飞书/Matrix 或测试用通道）。
- **太白**：联络 Agent 与天枢——接收天枢信息、转发 Agent；Agent 按天枢规范输出、经太白回传天枢。不执行、不实现监听逻辑。
- **獬豸**：一套机制，达到监听的效果（策略、`/auth/exec`、sandbox-profile、代理、CHEQ、链上审计等）。不执行业务逻辑。

---

**版本**：v1.1  
**日期**：2026-02-15  
**变更**：明确执行在 Agent；獬豸为一套机制、达到监听效果；太白仅负责联络 Agent 与天枢。
