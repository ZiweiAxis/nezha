# BMAD 偏差纠正方案（Sprint Change Proposal）

**依据**：BMAD correct-course 工作流（`_bmad/bmm/workflows/4-implementation/correct-course`）  
**触发**：PRD→架构→Epics→Stories→代码 一致性检查（2026-02-16）及主仓与子项目 BMAD 一致性检查中识别的偏差与建议  
**产出**：本方案 + 具体变更提案与实施交接  
**日期**：2026-02-16  

---

## 1. 问题摘要（Issue Summary）

### 1.1 触发来源

- **BMAD-PRD-架构-Epics-Stories-代码一致性检查报告-2026-02-16**：根无单独 prd.md、wukong 无 Epic/Story 编号、tianshu 建议做 Story→代码追溯。
- **紫微主仓与子项目BMAD一致性检查报告**：已完成的纠偏（taibai 路径、bmb→bmm、AGENTS.md）已记录；可选项为 manifest ides 统一、wukong communication_language 说明。

### 1.2 偏差清单（待纠偏）

| 编号 | 偏差描述 | 影响范围 | 类型 |
|------|----------|----------|------|
| D1 | 根目录无单独 `prd.md`，仅以 product-brief + 技术方案作为范围输入 | 工具链/审计命名一致、与子项目 prd.md 对齐 | 文档/命名 |
| D2 | wukong 无 Epic/Story 编号，仅 implementation-plan 阶段与 ROADMAP Phase/Sprint | BMAD 链路可追溯性、Story→代码对应 | 规划产物 |
| D3 | tianshu 未做 E4/E7 与 I-018 相关 Story→代码路径的显式追溯 | 实现可验证性、后续维护 | 子项目内追溯 |
| D4 | （可选）各子项目 manifest ides 不一致；wukong communication_language 未在文档说明 | 多 IDE 体验一致、避免误解 | 配置/文档 |

### 1.3 已完成的纠偏（无需本次执行）

- taibai 绝对路径 → 已改为 `ziwei/docs/open/technical/...`
- document-project 下 config_source `bmb` → `bmm`（主仓、taibai、wukong）
- 根目录统一 Agent 文档 AGENTS.md、规约与多 IDE 约定
- 一致性报告中 tianshu/diting _bmad 状态已更正为「本地有、主仓跟踪」

---

## 2. 影响分析（Impact Analysis）

### 2.1 Epic 影响

- **根**：无 Epic 变更；D1 仅影响规划产物命名与引用方式。
- **wukong**：D2 需在 wukong 增加 Epic/Story 层级，与现有 ROADMAP/implementation-plan 对应，不改变交付范围，仅增加可追溯结构。

### 2.2 产物冲突与更新

- **PRD**：根 planning-artifacts 需新增或重命名一份 PRD 引用（D1）；子项目 PRD 无需改。
- **Architecture**：无冲突。
- **Epics/Stories**：wukong 需新增 epics.md 或 ISSUE_LIST（D2）；其余子项目无需改。
- **其他**：tianshu 在子项目内增加「E4/E7、I-018 与代码路径」的简短追溯记录（D3）；可选 D4 为配置与说明文档。

### 2.3 技术/实现影响

- 无代码逻辑变更；仅为文档与规划产物增补与对齐。
- 实施工作量：低（根 PRD 占位、wukong Epic 清单、tianshu 追溯文档）。

---

## 3. 推荐路径（Path Forward）

**选择：Direct Adjustment（直接调整）**

- 通过**修改/新增现有规划产物**即可完成纠偏，无需回滚、无需调整 MVP 范围。
- 理由：偏差均为「命名/结构/可追溯性」类，不涉及需求或架构变更；实施成本低、风险低。
- 工作量：低 | 风险：低 | 时间影响：可当轮完成。

---

## 4. 具体变更提案（Detailed Change Proposals）

### 4.1 D1：根目录 PRD 占位

**目标**：与工具链及子项目 prd.md 命名对齐，便于 BMAD 工作流与审计引用。

| 项目 | 内容 |
|------|------|
| **产物** | 根 `_bmad-output/planning-artifacts/prd-ziwei.md`（新建） |
| **当前** | 无该文件；范围由 product-brief、紫微平台规划梳理、技术方案 共同承担 |
| **变更** | 新建 prd-ziwei.md，内容为「权威引用 + 范围摘要」：声明本仓库 PRD 由以下文档共同构成，并列出路径与用途；不复制全文。 |
| **理由** | 满足 correct-course 与实现就绪报告建议，不改变既有范围定义。 |

**实施**：由根侧 PM/维护者执行；交付物见下节「已执行纠偏」。

---

### 4.2 D2：wukong Epic/Story 清单

**目标**：为 wukong 建立与 BMAD 一致的 Epic/Story 可追溯结构。

| 项目 | 内容 |
|------|------|
| **产物** | wukong `_bmad-output/planning-artifacts/epics.md` 或 `ISSUE_LIST.md` |
| **当前** | 仅有 implementation-plan（阶段 1～4）、ROADMAP（Phase 0～3、Sprint 1～3），无 Epic/Story ID |
| **变更** | 新增 epics.md（或 ISSUE_LIST）：将 ROADMAP Phase/Sprint 映射为 Epic 编号（如 E1 身份管理、E2 生命周期、E3 状态与 CLI），Sprint 内任务映射为 Story ID（如 E1-S1、E1-S2）；可引用现有 implementation-plan 与 technical-spec。 |
| **理由** | 与 diting/tianshu 的 epics、ISSUE_LIST 结构对齐，便于平台 Epic 映射与 Story→代码追溯。 |

**实施**：由 wukong 子项目侧（或根侧代写后落 wukong 目录）执行；交付物见下节「已执行纠偏」。

---

### 4.3 D3：tianshu Story→代码追溯

**目标**：在 tianshu 子项目内显式记录 E4/E7、I-018 与代码路径的对应关系。

| 项目 | 内容 |
|------|------|
| **产物** | tianshu `_bmad-output/planning-artifacts/` 下新增或更新文档（如 story-to-code-trace.md 或 next-stage 中增加一节） |
| **当前** | 根报告建议「E4/E7、I-018 相关 Story→代码路径轻量追溯」，未在子项目内落档 |
| **变更** | 在 tianshu 内列出：E4-S4（谛听初始化）、E4-S5（心跳）、I-018（DID 调用）对应的代码路径或模块；便于后续维护与验收。 |
| **理由** | 实现可验证性、与 BMAD 链路一致性报告建议一致。 |

**实施**：**交接子项目 Agent**（ziwei/tianshu 下由 PM 或 Dev 执行）；根侧不代做子项目内文档。

---

### 4.4 D4（可选）：manifest ides 与 wukong 语言说明

| 项目 | 内容 |
|------|------|
| **变更** | 若希望多 IDE 体验一致，可统一各子项目 _bmad/_config/manifest 的 ides 列表；在 wukong README 或 planning-artifacts 中注明 communication_language 为「子项目本地偏好」。 |
| **实施** | 可选；由各子项目或根侧按需执行。 |

---

## 5. 实施交接（Implementation Handoff）

| 偏差 | 范围 | 交接对象 | 交付物与责任 |
|------|------|----------|----------------|
| D1 | 根 | 根侧 PM/维护者 | 新建 prd-ziwei.md（权威引用+范围摘要） |
| D2 | wukong | wukong 子项目 / 根侧代写 | 新建 wukong epics.md 或 ISSUE_LIST，映射 ROADMAP→Epic/Story ID |
| D3 | tianshu | **子 Agent（ziwei/tianshu）** | 在 tianshu _bmad-output 下新增或更新 Story→代码追溯 |
| D4 | 可选 | 各子项目 / 根 | manifest 与 README 说明 |

**成功标准**：  
- D1：根 planning-artifacts 下存在 prd-ziwei.md 且引用正确。  
- D2：wukong 存在 epics 或 ISSUE_LIST，且含 Epic/Story ID 与 ROADMAP/implementation-plan 对应关系。  
- D3：tianshu 存在 E4/E7、I-018 与代码路径的显式记录。  
- D4：按需完成即可。

---

## 6. 本次已执行纠偏（当轮完成）

以下在编写本方案时已执行，无需再派单：

1. **D1**：✅ 已新建根 `_bmad-output/planning-artifacts/prd-ziwei.md`，内容为 PRD 权威引用（产品简报、紫微平台规划梳理、技术方案）与范围摘要。
2. **D2**：✅ 已在 wukong 新建 `wukong/_bmad-output/planning-artifacts/epics.md`，将 ROADMAP Phase 1 Sprint 1～4 映射为 Epic E1～E4 及 Story ID（E1-S1～E4-S3），并注明与 ROADMAP、implementation-plan 的对应关系。

**待交接**：  
- **D3**：由用户在 **ziwei/tianshu** 目录下交由子 Agent 执行「E4/E7、I-018 与代码路径」追溯，并在 tianshu _bmad-output/planning-artifacts 下落档。
- **D4**：可选；按需统一 manifest ides 或补充 wukong communication_language 说明。

---

*本方案按 BMAD correct-course 工作流结构编写，偏差来源为 2026-02-16 一致性检查报告；具体变更提案与实施交接已纳入上述各节。*
