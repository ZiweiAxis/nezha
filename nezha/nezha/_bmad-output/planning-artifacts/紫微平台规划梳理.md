# 紫微平台规划梳理

**版本**：v1.0  
**日期**：2026-02-13  
**视角**：PM（BMAD）— 平台级规划，功能下沉子模块  
**目的**：明确紫微作为「各子模块复合体」的定位，补齐规划缺口，形成可执行的平台与子模块分工。

---

## 1. 紫微平台 = 子模块复合体

紫微**不是**单一代码库，而是由多个子模块组成的**治理平台复合体**：

| 子模块 | 职责（技术方案） | 当前形态 | 规划/实现落点 |
|--------|------------------|----------|----------------|
| **天枢** | 通信枢纽、身份控制平面、企业 IM 适配 | 独立仓库/目录 `tianshu/`，有 PRD、架构、Epics | `tianshu/_bmad-output/`、`tianshu/docs/` |
| **谛听** | 策略与审批、审计存证、链上 DID 与存证管理 | 独立目录 `diting/`，All-in-One 已闭环，Issue 列表在列 | `diting/_bmad-output/`、`diting/ISSUE_LIST.md` |
| **太白** | 接入规范、多语言 SDK、预置适配器、接入验证用智能体 | 独立目录 `taibai/`，Python SDK + examples/verification_agent | `ziwei/taibai/`、`taibai/docs/` |
| **共享/平台** | 总体架构、跨子模块接口、技术方案、部署与合规 | 根目录 `ziwei/docs/open/technical/` 技术方案 + 架构图 | `ziwei/docs/open/technical/`、本文档所在 `ziwei/_bmad-output/planning-artifacts/` |

**原则**：  
- **平台层**定义「做什么、边界、接口与标准」；  
- **具体功能实现**下沉到各子模块，由各子模块的 PRD/Epics/Issue 承接。

---

## 2. 现状与已有规划

### 2.1 已有

- **根目录**
  - `ziwei/docs/open/technical/紫微智能体治理基础设施-技术方案.md`：总体架构、天枢/谛听/太白职责、DID/链/接口、部署与安全。
  - `ziwei/docs/open/technical/紫微智能体治理基础设施-架构图.drawio`：组件关系与边界。
  - `ziwei/docs/open/technical/BMAD-多子项目管理-最佳实践.md`、`ziwei/docs/open/technical/紫微跨子项目文档方案-通用约定.md`：BMAD 与文档归属约定。
  - `ziwei/_bmad-output/`：根 BMAD 已安装，规划产物可落于此（本文档即首份）。
- **天枢**
  - PRD、architecture、epics-and-stories、next-stage；与主项目对齐文档（design-alignment-with-ziwei）。
- **谛听**
  - PRD、architecture、epics、implementation-readiness、pm-what-to-do-next；ISSUE_LIST（含跨子项如 I-016～I-018 天枢对接 DID）。

### 2.2 子模块规划引用关系

- 各子项目 PRD/架构**必须引用**根 `ziwei/docs/open/technical/紫微智能体治理基础设施-技术方案.md`。
- 跨子项目接口（如天枢–谛听 DID/审批）在技术方案与子项目 architecture 中写清；具体任务在子项目 Issue/Story 中落地（如 diting I-018）。

---

## 3. 缺口与限制（待完善）

| 缺口 | 说明 | 建议落点 |
|------|------|----------|
| **根目录无总体 PRD / 产品简报** | 平台级「做哪些能力、为谁、优先级」未成文，仅技术方案描述架构与能力。 | `ziwei/_bmad-output/planning-artifacts/`：新增 product-brief 或 prd-ziwei.md |
| **根目录无平台级 Architecture** | Integration、子模块边界、Standards and Conventions、ADR 未在根层集中维护。 | 根 planning-artifacts：architecture-ziwei.md（或合并到技术方案 v2） |
| **太白未独立为子模块** | 技术方案中的「太白」职责（SDK、适配器、接入规范）尚无独立规划与实现边界。 | 决策：独立 repo/目录 + PRD；或明确「太白能力由天枢+文档暂担」并写入技术方案 |
| **链与 DID 未全贯通** | 谛听侧 I-016～I-018（私有链、DID API、天枢对接）未完成；天枢侧 DID 仍依赖谛听接口（设计已对齐）。 | 子模块：diting 按 ISSUE_LIST 推进 I-016/I-017/I-018；天枢在 DID 接口就绪后对接 |
| **平台级验收与里程碑未成文** | 何谓「紫微平台 MVP 验收」、各子模块何时达到「可联调」未写清。 | 根 planning-artifacts：定义平台 Epic/里程碑与子模块交付映射 |
| **功能下沉原则未显式写** | 「哪些归平台、哪些归子模块」未在单一文档中集中说明，易产生重复或遗漏。 | 本文档 §4 + 根 architecture 或技术方案增补小节 |

---

## 4. 功能下沉原则（平台 vs 子模块）

以下为建议约定，可写入根 architecture 或技术方案附录。

### 4.1 归属平台（根 / 跨子项目）

- **产品与架构**：平台愿景、能力清单、非功能目标（性能、安全、合规）、跨子模块接口契约（API、事件、配置约定）。
- **标准与约定**：目录与仓库命名、BMAD 与文档归属、提交与发布约定（见《紫微跨子项目文档方案-通用约定》）。
- **集成与部署**：紫微治理集群的拓扑、子模块部署顺序、环境与配置分层（若由根维护 compose 或脚本）。
- **验收与路线图**：平台级 Epic/里程碑、各子模块交付物与时间节点（高 level）。

### 4.2 归属子模块

- **需求与设计**：本子模块的 PRD、UX、本地 architecture、Epics/Stories。
- **实现与测试**：代码、单测、E2E、本子模块的 Issue/Story 执行。
- **交付与运维**：本子模块的构建、镜像、部署文档、健康检查与运维手册。
- **跨子项目依赖**：在子项目 Issue/Story 中注明依赖（如「依赖 diting I-017 的 DID 接口」），由各子项目 PM/开发自行排期与对接。

### 4.3 争议或重叠时

- **接口与契约**：以根技术方案 + 根 architecture（若创建）为准；子模块 architecture 不得与之冲突，可写「本地 ADR」细化实现选择。
- **新能力归属**：若新能力跨两个以上子模块，优先在根规划中先定义边界与接口，再下沉为各子模块 Epic/Issue。

---

## 5. 建议的下一步规划动作

| 序号 | 动作 | 产出 | 负责人/方式 | 状态 |
|------|------|------|--------------|------|
| 1 | **根目录产品简报或 PRD** | 平台级愿景、用户/场景、能力列表、优先级与里程碑（高 level） | 根目录运行 BMAD create-product-brief 或 create-prd，产出存 `ziwei/_bmad-output/planning-artifacts/` | ✅ 已产出 `product-brief-ziwei-2026-02-13.md`（2026-02-13） |
| 2 | **根目录 Architecture** | Integration、子模块边界、Standards and Conventions、ADR；可部分复用技术方案，形成「规划用」单份 | 根目录运行 create-architecture，或基于技术方案提炼为 architecture-ziwei.md | ✅ 已产出 `architecture-ziwei.md`（2026-02-13） |
| 3 | **平台 Epic 与子模块映射** | 平台 Epic 列表 + 每个 Epic 对应哪些子模块的哪些 Epic/Issue | 根 create-epics-and-stories 或手写 platform-epics-and-submodule-mapping.md | ✅ 已产出 `platform-epics-and-submodule-mapping.md`（2026-02-13） |
| 4 | **太白边界决策** | 太白独立子模块 vs 由天枢+文档暂担；若独立则新建 PRD/架构 | 产品/架构决策后更新技术方案与根规划 | ✅ 已产出 `太白边界决策.md`（2026-02-13）：暂不独立，由天枢+文档暂担 |
| 5 | **子模块对齐** | 谛听/天枢的 pm-what-to-do-next、ISSUE_LIST 与根「下一步」对齐，避免冲突或遗漏 | 定期对照根 planning-artifacts 与子项目 _bmad-output/ISSUE_LIST | ✅ 已产出 `根与子模块规划对齐.md`（2026-02-13）；引用路径约定为 ziwei/docs/open/technical/ |

---

## 6. 小结

- **紫微 = 天枢 + 谛听 + 太白（及共享能力）的复合体**；规划需同时覆盖平台层与子模块层。
- **现状**：技术方案与文档约定已有；天枢、谛听各有 BMAD 规划与实现；根目录 BMAD 已安装，规划产物可落于 `ziwei/_bmad-output/planning-artifacts/`。
- **已补齐**：根产品简报、根 Architecture、平台 Epic 与子模块映射、太白边界决策、根与子模块规划对齐（§5 动作 1～5 均已完成）。
- **待实现**：链/DID 贯通由子项目谛听 I-016～I-018、天枢 I-018 对接承接；平台验收标准可在后续根 PRD 或验收清单中细化。
- **建议**：子模块继续按各自 PRD/Issue 推进；定期对照《根与子模块规划对齐》更新引用与状态。

本文档为**规划梳理**初版，后续可在根目录执行 BMAD 工作流（如 create-prd、create-architecture、create-epics-and-stories）时迭代更新，并保持与 `ziwei/docs/open/technical/紫微跨子项目文档方案-通用约定.md` 一致。
