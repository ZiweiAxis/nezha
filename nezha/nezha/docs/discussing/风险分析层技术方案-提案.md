# 风险分析层技术方案 - 提案

> 状态：讨论中
> 创建时间：2026-02-16
> 来源：克浩提供

---

## 结论

**"基于算法的跟踪与预测 + 风险判断"** 业界已有成熟开源技术，可直接用于商业项目，许可证友好。

已有能力：**Cedar 授权 + 网关 + CHEQ** = 策略/决策层

需要补充：**行为/风险分析层** + **决策/治理层**

---

## 一、整体架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                    已有层                                            │
├─────────────────────────────────────────────────────────────────────┤
│  PEP (网关/Xiezhi) → PDP (Cedar) → CHEQ (人类确认)                 │
└─────────────────────────────────────────────────────────────────────┘
                              ↑
                              │ 调用
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    新增：风险分析与决策层                            │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌──────────────┐   ┌──────────────┐   ┌──────────────┐          │
│  │   UEBA       │ → │  RiskEngine  │ → │   Decision   │          │
│  │ 行为分析引擎  │   │  风险评分引擎  │   │  决策框架     │          │
│  └──────────────┘   └──────────────┘   └──────────────┘          │
│       ↑                                    │                        │
│       │ 行为特征/异常分                    │ 最终决策                │
│       │                                    ▼                        │
│       └────────────────────────────────────────┘                    │
│                           PDP (Cedar)                               │
└─────────────────────────────────────────────────────────────────────┘
```

**核心思路**：
- **Cedar** 负责"能不能做"的授权判断
- **UEBA / RiskEngine / Decision** 负责"这个操作/主体有多危险，要不要额外处理"

---

## 二、可落地的开源技术栈

### 1. 行为分析与异常检测（UEBA / Anomaly Detection）

| 项目 | 许可证 | 说明 |
|------|--------|------|
| **Kitsune** (MIT) | ✅ 商业友好 | 在线网络异常检测，基于自编码器，无监督，适合实时流 |
| **OpenUBA** (GPL-3.0) | ⚠️ 需注意 | 开源 UEBA 框架，内置多种 ML 模型，需作为独立服务调用 |
| Apache Metron / Wazuh | 较重 | 完整 SIEM/XDR 方案，适合已有日志平台 |

**推荐**：Kitsune（MIT）+ 自建特征工程

---

### 2. 风险评分引擎（Risk Scoring Engine）

| 项目 | 许可证 | 说明 |
|------|--------|------|
| **Financial-Fraud-Risk-Engine** (MIT) | ✅ 商业友好 | 端到端金融欺诈风险评分，含 ML 流水线 + SHAP 可解释 |
| 自建 Risk Scoring Service | - | 推荐：用 Python 写，集成 XGBoost/LightGBM |

---

### 3. 决策层：Policy-as-Code

| 项目 | 许可证 | 说明 |
|------|--------|------|
| **decision-layer** (MIT) | ✅ 商业友好 | 决策框架，把策略/法规变成可执行函数，支持 OPA/Rego 集成 |
| **OPA / Rego** | Apache-2.0 | 可用 Rego 写风险决策策略 |

---

### 4. AI 治理与风险框架（参考）

- **FINOS AI Governance Framework** - 金融业开源 AI 治理框架
- **NIST AI RMF** - AI 风险管理框架
- **CSA AI Model Risk Management** - AI 模型风险管理

---

## 三、许可证与商业冲突

### 商业友好的许可证（可闭源商用）

- **MIT**：Kitsune、Financial-Fraud-Risk-Engine、decision-layer
- **Apache-2.0**：OPA

### 需要注意的许可证

- **GPL-3.0**（如 OpenUBA）：可以商用，但若修改源码并分发需开源

---

## 四、推荐落地方案

### 1. UEBA 服务

**方案**：部署 OpenUBA（GPL-3.0）作为独立 UEBA 服务，只调用其接口

- 不修改源码，作为独立服务部署
- 输入：AI 操作事件日志
- 输出：行为特征、异常分

### 2. 风险评分服务

**方案**：参考 Financial-Fraud-Risk-Engine（MIT）架构，自建风险评分服务

```
输入：
├─ 主体 DID
├─ 操作类型
├─ 资源特征
└─ 上下文（时间、设备、来源等）

输出：
├─ risk_score (0-1)
├─ risk_level (low/medium/high)
└─ risk_tags (abnormal_access, excessive_export, etc.)
```

### 3. 决策层

**方案**：使用 decision-layer（MIT）作为"决策框架"

整合内容：
- Cedar 的授权结果
- 风险评分结果
- CHEQ 是否已确认

输出：统一决策给网关（Allow/Deny/Review + 风险标签）

### 4. 治理与合规

- **FINOS AI Governance Framework** - 风险清单和治理流程
- **NIST / CSA AI RMF** - 持续监控思路

---

## 五、与现有系统的集成

| 现有模块 | 集成方式 |
|----------|----------|
| Cedar (PDP) | 决策框架调用 Cedar 获取授权结果 |
| CHEQ | 高风险操作触发人工确认 |
| Xiezhi (PEP) | 接收最终决策，执行 Allow/Deny/Review |
| 审计日志 | 记录风险评分、决策过程 |

---

## 六、小结

| 层次 | 已有 | 需要补充 |
|------|------|----------|
| 授权决策 | ✅ Cedar | - |
| 风险判断 | ❌ | ✅ UEBA + 风险评分 |
| 人工确认 | ✅ CHEQ | - |
| 治理合规 | ❌ | ✅ FINOS / NIST |

**结论**：Cedar 已经解决了"授权决策"，但"风险判断 + 行为分析"需要单独一层。业界已有不少 MIT/Apache-2.0 开源项目，可直接在商业项目中使用，商业冲突很小。

---

## 七、相关文档

- [网关拦截流程设计-提案.md](./网关拦截流程设计-提案.md)
- [CHEQ-IETF草案.md](../open/technical/CHEQ-IETF草案.md)
