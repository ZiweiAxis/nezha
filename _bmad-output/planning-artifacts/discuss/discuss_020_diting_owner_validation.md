# 讨论：E020 - 谛听注册 OwnerID 验证

## 背景

谛听到天枢注册时，需要提供预注册的 `owner_id`。

## 流程设计

### 原则
1. 天枢预注册：admin（管理员）、diting（谛听）
2. 谛听使用预注册的 owner 进行注册，不自动创建

### 流程

```
┌─────────────────────────────────────────────────────────┐
│                  天枢启动                               │
├─────────────────────────────────────────────────────────┤
│  预注册：admin（管理员）                                │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│            管理员手动注册谛听 Owner                     │
├─────────────────────────────────────────────────────────┤
│  POST /api/v1/owners/register                          │
│  Body: {"owner_id": "diting", "identities": {...}}   │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│                  谛听启动                                │
├─────────────────────────────────────────────────────────┤
│  POST /api/v1/agents/register                          │
│  Body: {"owner_id": "diting", "agent_display_id": "diting"} │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│                  天枢处理                               │
├─────────────────────────────────────────────────────────┤
│  验证 owner_id 已预注册 → 返回 agent_id                │
└─────────────────────────────────────────────────────────┘
```

### 预注册内容

**天枢初始化时**：
```python
# init_system.py
store.set("owners", "admin", {...})      # 管理员（预注册）
# driting 由管理员手动注册
```

### 谛听配置

```bash
DITING_OWNER_ID=diting
```

### 管理员手动注册 Owner

需要添加 API：
```bash
POST /api/v1/owners/register
Body: {
    "owner_id": "diting",
    "identities": {"system": {"type": "diting", "name": "Diting"}}
}
```

## 待确认

- [x] 天枢只预注册 admin
- [ ] 管理员手动注册谛听 Owner
- [ ] 添加 Owner 注册 API
